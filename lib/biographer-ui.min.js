(function(a){var b=a.document,c=a.navigator,d=a.location;bui={},bui.svgns="http://www.w3.org/2000/svg",bui.settings={SBGNlang:"PD",straightenEdges:!0,initialHighPerformance:!0,enableModificationSupport:!0,staticSVG:!1,animationFPS:30,idPrefix:{graph:"graph",node:"node",edge:"edge",connectingArc:"connectingArc"},idSuffix:{hover:"hover"},dataFormat:{nodes:"nodes",edges:"edges",drawable:{id:"id",visible:"visible",sbo:"sbo",cssClasses:["data","cssClasses"]},node:{label:["data","label"],x:["data","x"],y:["data","y"],width:["data","width"],height:["data","height"],subNodes:["data","subnodes"],modification:["data","modification"],statevariable:["data","statevariable"]},edge:{source:"source",target:"target",style:["data","style"],type:["data","type"],handles:["data","handles"],points:["data","points"]}},css:{stylesheetUrl:"../static/bui/css/visualization-svg.css",classes:{invisible:"hidden",selected:"selected",rectangle:"rect",complex:"complex",compartment:"compartment",process:"process",perturbation:"perturbation",statevariable:"statevariable",smallText:"small",textDimensionCalculation:{generic:"textDimensionCalculation",standard:"defaultText",small:"smallText"},line:"line",lineStyle:{solid:"solid",dotted:"dotted",dashed:"dashed"},lineHover:"lineHover",connectingArcs:{stimulation:"stimulation",assignment:"assignment",catalysis:"catalysis",control:"control",necessaryStimulation:"necessaryStimulation",absoluteInhibition:"absoluteInhibition"},splineEdgeHandle:"splineEdgeHandle",splineAutoEdgeHandle:"autoAlign",hideBorder:"hideBorder"}},style:{graphReduceCanvasPadding:30,edgeHandleRadius:4,nodeCornerRadius:15,adaptToLabelNodePadding:{top:5,right:5,bottom:5,left:5},complexCornerRadius:15,complexTableLayout:{padding:10,restrictNumberOfColumns:!1,showBorder:!0},compartmentCornerRadius:{x:25,y:15},processNodeMinSize:{width:26,height:26},helperNodeMinSize:{width:5,height:5},edgeToNodePadding:{topBottom:5,leftRight:5},importer:{standardNodeSize:{width:70,height:70},sizeBasedOnLabelPassing:{horizontal:20,vertical:20},modificationLabel:"long"},automaticAuxiliaryUnitPositioning:[[0,0],[1,1],[1,0],[0,1],[.5,0],[1,.5],[.5,1],[0,.5]],markerWidthCorrection:.25}},function(a){var b=[];a.ready=function(a){b.push(a)},$(function(){for(var a=0;a<b.length;a++)b[a]()}),a.Object=function(){this.__private={}},a.Object.prototype._getPrivateMembers=function(a){var b=this.__private[a];return b===undefined&&(b={},this.__private[a]=b),b},a.Object.prototype._privates=function(a){return this._getPrivateMembers(a)}}(bui);var f=function(a,b,c){var d=this.size().width/2;return d+=Math.sqrt(Math.pow(c.topBottom,2)+Math.pow(c.leftRight,2)),{opposite:Math.sin(b)*d,adjacent:Math.cos(b)*d}},g=function(a,b){return f.call(this,a,b,bui.settings.style.edgeToNodePadding)},h=function(a,b){return f.call(this,a,b,{topBottom:0,leftRight:0})};(function(c){c.util={},c.util.createPrototypeValue=function(a){return{value:a,enumerable:!0,configurable:!0,writable:!0}},Function.prototype.createDelegate=function(a){var b=this;return function(){return b.apply(a,arguments)}},String.prototype.removeNonNumbers=function(){return this.replace(/[^0-9]/g,"")},String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1},c.util.calculateWordDimensions=function(a,d,e,f){d===undefined&&(d=[]),e===undefined&&(e=!0);if(c.settings.staticSVG||f!==undefined){var g=c.util.precalcLetterWidth(),h=0;for(var i=0;i<a.length;i++)h+=g[a.charAt(i)];return h<=1&&(h=1),{width:h,height:16}}d.push(c.settings.css.classes.textDimensionCalculation.generic);var j=b.createElement("div");j.setAttribute("class",d.join(" ")),e===!0?$(j).text(a):j.innerHTML=a,b.body.appendChild(j);var k={width:jQuery(j).outerWidth(),height:jQuery(j).outerHeight()};return j.parentNode.removeChild(j),k},c.util.calculateTextDimensions=function(a,b){var d=a.split(/\s/);for(var e=0;e<d.length;e++){var f=d[e],g=c.util.calculateWordDimensions(f,b);g.word=f,d[e]=g}return d},c.util.calculateLabelPositioning=function(a,b,d){var e=c.util.calculateTextDimensions(b,d),f=c.util.calculateWordDimensions("&nbsp;",d,!1).width,g=[],h=null,i=0,j=function(){h!==null&&(h.maxHeight=i),i=0,g.push({words:[],availableWidth:a}),h=g[g.length-1]};j();var k=function(a){h.words.push(a),h.availableWidth-=a.width+f,i=Math.max(i,a.height)};for(var l=0;l<e.length;l++){var m=e[l];m.width<=h.availableWidth?k(m):(h.words.length!==0&&j(),k(m))}h.maxHeight=i;for(l=0;l<g.length;l++){var n=g[l];n.availableWidth+=f,n.horizontalIndention=n.availableWidth/2,n.totalWidth=a-n.availableWidth,n.spaceWidth=f,delete n.availableWidth}return g};var d=undefined;c.util.precalcLetterWidth=function(){if(d)return d;var a="abcdefghijklmnopqrstuvwzxz",c="1234567890_-@.:",e={},f=b.createElement("span");$(f).html("A");if($(f).width()>1){for(var g=0;g<a.length;g++)$(f).html(a.charAt(g)),e[a.charAt(g)]=$(f).width();a=a.toUpperCase();for(var g=0;g<a.length;g++)$(f).html(a.charAt(g)),e[a.charAt(g)]=$(f).width();for(var g=0;g<c.length;g++)$(f).html(c.charAt(g)),e[c.charAt(g)]=$(f).width();return d=e,e}return d={0:8,1:8,2:8,3:8,4:8,5:8,6:8,7:8,8:8,9:8,a:8,b:8,c:7,d:8,e:8,f:4,g:8,h:8,i:3,j:3,k:7,l:3,m:13,n:8,o:8,p:8,q:8,r:5,s:7,t:5,u:8,v:7,w:9,z:7,x:7,A:9,B:9,C:9,D:10,E:8,F:7,G:10,H:10,I:3,J:3,K:8,L:7,M:11,N:10,O:10,P:8,Q:10,R:8,S:9,T:7,U:10,V:9,W:11,Z:10,X:8},d},c.util.setSuperClass=function(a,b){var d=a.prototype;for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];d[e]=c.util.createPrototypeValue(f)}a.prototype=Object.create(b.prototype,a.prototype),a.superClazz=b};var e=0;c.util.createListenerTypeId=function(){return e++},c.util.createMarkerAttributeValue=function(a){return["url(#",a,")"].join("")},c.util.getHoverId=function(a){return a+c.settings.idSuffix.hover},c.util.retrieveValueIfSet=function(a,b){a=arguments[0];for(var c=1;c<arguments.length&&a!==undefined;c++)a=a[arguments[c]];return a},c.util.propertySetAndNotNull=function(){var b=arguments[0];for(var d=1;d<arguments.length;d++){var e=arguments[d];if(typeof e=="string"){if(b.hasOwnProperty(e)===!1||b[e]===null)return!1}else{e.splice(0,0,b);var f=c.util.retrieveValueIfSet.apply(a,e);if(f===undefined||f===null)return!1}}return!0},c.util.toNumber=function(a){var b=typeof a;if(b==="number")return a;if(b==="string"&&isNaN(a)===!1)return parseFloat(a);throw"It can't be ensured that the value: \""+a+'" is a number.'},c.util.toBoolean=function(a){var b=typeof a;if(b==="boolean")return a;if(b==="string")return a.toLowerCase()==="true"||a==="1";if(b==="number")return a===1;throw'The value: "'+a+"can't be converted to boolean."},c.util.alignCanvas=function(b,c,d,e){var f=b.drawables(),g;for(var h in f)if(f.hasOwnProperty(h)){var i=f[h];i.json()!==null&&i.json().id===c&&(g=i)}if(g===undefined){j("Node with id "+c+" could not be found in the graph.");return}var k=g.absolutePosition(),l=g.size(),m=b.scale(),n=b.htmlTopLeft();if(d===undefined||e===undefined)d=jQuery("body"),e=jQuery(a);var o=k.x*m-(e.width()-l.width*m)/2+n.x,p=k.y*m-(e.height()-l.height*m)/2+n.y;d.animate({scrollLeft:o,scrollTop:p})},c.util.transformJSONCoordinates=function(a){var b=a.nodes,d=Number.MAX_VALUE,e=Number.MAX_VALUE,f,g;for(g=0;g<b.length;g++)f=b[g],c.util.propertySetAndNotNull(f,["data","x"],["data","y"])&&(f.data.x=c.util.toNumber(f.data.x),f.data.y=c.util.toNumber(f.data.y),d=Math.min(d,f.data.x),e=Math.min(e,f.data.y));d>0?d=0:d=Math.abs(d),e>0?e=0:e=Math.abs(e);if(d!==0&&e!==0)for(g=0;g<b.length;g++)f=b[g],c.util.propertySetAndNotNull(f,["data","x"],["data","y"])&&(f.data.x+=d,f.data.y+=e)},c.util.clone=function(a,b,d){var e=a.suspendRedraw(2e4);all_drawables=a.drawables();var f=[],g={},h,i,j,k;for(var l in all_drawables){h=all_drawables[l];if(h.identifier()=="bui.UnspecifiedEntity"||h.identifier()=="bui.SimpleChemical"||h.identifier()=="bui.RectangularNode"||h.identifier()=="bui.Phenotype"||h.identifier()=="bui.NucleicAcidFeature"||h.identifier()=="bui.Macromolecule")g[h.id()]=0}for(var l in all_drawables)h=all_drawables[l],h.identifier()=="bui.Edge"&&(h.source().id()in g&&(g[h.source().id()]=g[h.source().id()]+1),h.target().id()in g&&(g[h.target().id()]=g[h.target().id()]+1));var m=1e3;for(var l in g){if(!(d===undefined||l in d))continue;h=all_drawables[l];if(g[h.id()]>b){j=h.id();for(var n in all_drawables)i=all_drawables[n],i.identifier()=="bui.Edge"&&(i.source().id()==j||i.target().id()==j)&&(++m,k=a.add(c[h.identifier().substr(4)]).visible(!0).label(h.label()).parent(h.parent()).position(h.position().x,h.position().y).size(h.size().height,h.size().width),f.push(k),i.source().id()==j?all_drawables[n].source(k):all_drawables[n].target(k))}}for(var l in all_drawables)if(d===undefined||l in d)h=all_drawables[l],h.id()in g&&g[h.id()]>b&&h.remove();else continue;return a.unsuspendRedraw(e),f},c.util.combine=function(a,b){var d=a.suspendRedraw(2e4);all_drawables=a.drawables();var e=all_drawables[Object.keys(b)[0]],f=a.add(c[e.identifier().substr(4)]).visible(!0).label(e.label()).parent(e.parent()).position(e.position().x,e.position().y).size(e.size().height,e.size().width);for(var g in all_drawables){edge=all_drawables[g];if(edge.identifier()=="bui.Edge")for(var h in b)edge.source().id()==all_drawables[h].id()&&all_drawables[g].source(f),edge.target().id()==all_drawables[h].id()&&all_drawables[g].target(f)}for(var h in b)all_drawables[h].remove();a.unsuspendRedraw(d)}})(bui);var j=function(a){console!==undefined&&console.log!==undefined&&console.log(a)},k=function(a,b,c){if(typeof b=="string")a[b]=c;else if(b!==undefined){var d=a;for(var e=0;e<b.length-1;e++){var f=b[e];d[f]=d[f]||{},d=d[f]}d[b[b.length-1]]=c}},l=function(a,b,c,d){var e={klass:c};d!==undefined&&(e.generator=d);for(var f=0;f<b.length;f++)a[b[f]]=e},m={},n={},o={},p={};(function(a){a.nodeMapping=m,a.processNodeMapping=n,a.modificationMapping=p,a.edgeMarkerMapping=o})(bui);var r=function(a,b,c){var d={"long":b,"short":c};for(var e=0;e<a.length;e++)p.hasOwnProperty(a[e])?j("Warning: The mapping of modification keys has already a mapping for key: "+a[e]):p[a[e]]=d},s=function(a,b){if(a.hasOwnProperty(b))return a[b];throw'Warning: SBO id "'+b+'" could not be found.'},t=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c].klass;if(typeof d=="function"&&b instanceof d)return bui.util.toNumber(c)}return null},u=function(a){a=a.toLowerCase();for(var b in p)if(p.hasOwnProperty(b)){var c=p[b];if(a===c.short.toLowerCase()||a===c.long.toLowerCase())return bui.util.toNumber(b)}return null},v=function(a){for(var b in o)if(o.hasOwnProperty(b)){var c=o[b];if(c.klass===a)return bui.util.toNumber(b)}return null};(function(a){var b="bui.Observable";a.Observable=function(){a.Observable.superClazz.call(this),this._getPrivateMembers(b).listener={}};var c={},d=function(a){return c[a]=c[a]||{}};a.Observable.bindStatic=function(a,b,c){var e=d(a);if(c===undefined||c===null)c=b;e[c]=b},a.Observable._unbindAllStatic=function(){c={}},a.Observable.prototype={_addType:function(a){var c=this._getPrivateMembers(b).listener;if(typeof a=="string")c[a]={};else for(var d in a)a.hasOwnProperty(d)&&(c[a[d]]={});return this},bind:function(a,c,d){var e=this._getPrivateMembers(b).listener[a];if(e===undefined)return this;if(d===undefined||d===null)d=c;return e[d]=c,this},unbind:function(a,c){var d=this._getPrivateMembers(b).listener;if(a===undefined)for(var e in d)d.hasOwnProperty(e)&&(d[e]={});else c===undefined?d[a]={}:delete d[a][c];return this},unbindAll:function(a){var c=this._getPrivateMembers(b).listener;for(var d in c)c.hasOwnProperty(d)&&delete c[d][a];return this},fire:function(a,c){var e,f;c===undefined&&(c=[]),f=this._getPrivateMembers(b).listener[a];if(f===undefined)return!0;for(e in f)if(f.hasOwnProperty(e)){var g=f[e].apply(this,c);if(g===!1)return!1}f=d(a),c.length===0?c=[this]:c[0]!==this&&c.unshift(this);for(e in f)if(f.hasOwnProperty(e)){var g=f[e].apply(this,c);if(g===!1)return!1}return!0}},a.util.setSuperClass(a.Observable,a.Object)})(bui),function(a){a.connectingArcs={};var c=0,d=function(c,d,e,f,g,h,i,j){j===undefined&&(j=1);var k=b.createElementNS(a.svgns,"marker");k.setAttributeNS(null,"id",c),k.setAttributeNS(null,"orient","auto"),k.setAttributeNS(null,"refX",e),k.setAttributeNS(null,"refY",f),k.setAttributeNS(null,"markerWidth",g*j),k.setAttributeNS(null,"markerHeight",h),k.setAttributeNS(null,"viewBox",["-2 -2",g+4,h+4].join(" ")),i!==undefined&&k.setAttributeNS(null,"class",i);if(typeof d=="string"){var l=b.createElementNS(a.svgns,"path");l.setAttributeNS(null,"d",d),i==a.settings.css.classes.connectingArcs.assignment||i==a.settings.css.classes.connectingArcs.production?l.setAttributeNS(null,"fill","black"):l.setAttributeNS(null,"fill","white"),l.setAttributeNS(null,"stroke","black"),k.appendChild(l)}else k.appendChild(jQuery(d).clone(!1)[0]);return k},e=function(b,e,f,g,h,i){var j=a.settings.idPrefix.connectingArc+c++,k=a.util.getHoverId(j),l=d(j,b,e,f,g,h,i),m=d(k,b,e,f,g,h,i,a.settings.style.markerWidthCorrection);return{id:j,hoverId:k,element:l,hoverElement:m}};a.connectingArcs.assignment=function(){return e("M0,0 S10,10,0,20 L20,10 Z",20,10,20,20,a.settings.css.classes.connectingArcs.assignment)},a.connectingArcs.assignment.id="assignment",a.connectingArcs.absoluteStimulation=function(){return e("M0,0 L0,20 L10,15 L10,5 L0,0 Z M10,0 L10,20 L25,10Z",25,10,35,20,a.settings.css.classes.connectingArcs.stimulation)},a.connectingArcs.absoluteStimulation.id="absoluteStimulation",a.connectingArcs.stimulation=function(){return e("M0,0L20,10L0,20Z",20,10,20,20,a.settings.css.classes.connectingArcs.stimulation)},a.connectingArcs.stimulation.id="stimulation",a.connectingArcs.production=function(){return e("M0,0L20,10L0,20Z",20,10,20,20,a.settings.css.classes.connectingArcs.production)},a.connectingArcs.production.id="production",a.connectingArcs.substrate=function(){return e("",20,10,20,20,a.settings.css.classes.connectingArcs.substrate)},a.connectingArcs.substrate.id="substrate",a.connectingArcs.inhibition=function(){return e("M0,0 V20 H1 V0 ZM22,0",2,10,20,22)},a.connectingArcs.inhibition.id="inhibition",a.connectingArcs.absoluteInhibition=function(){return e("M0,0 V25 M10,0 V25Z",10,12,10,26,a.settings.css.classes.connectingArcs.necessaryStimulation)},a.connectingArcs.absoluteInhibition.id="absoluteInhibition",a.connectingArcs.catalysis=function(){var c=b.createElementNS(a.svgns,"circle");return c.setAttributeNS(null,"cx",10),c.setAttributeNS(null,"cy",10),c.setAttributeNS(null,"r",10),c.setAttributeNS(null,"fill","white"),c.setAttributeNS(null,"stroke","black"),e(c,20,10,20,20,a.settings.css.classes.connectingArcs.catalysis)},a.connectingArcs.catalysis.id="catalysis",a.connectingArcs.control=function(){return e("M10,0L20,10L10,20L0,10Z",20,10,20,20,a.settings.css.classes.connectingArcs.control)},a.connectingArcs.control.id="control",a.connectingArcs.necessaryStimulation=function(){return e("M0,0 V20 M10,0 L25,10L10,20Z",25,10,26,26,a.settings.css.classes.connectingArcs.necessaryStimulation)},a.connectingArcs.necessaryStimulation.id="necessaryStimulation"}(bui),function(c){var d=0,e="bui.Graph",f=function(a){return e+a.id()},g=function(){var a=this._privates(e),b=[["scale(",a.scale.toString(),")"].join(""),["translate(",a.x,", ",a.y,")"].join("")].join(" ");a.rootGroup.setAttribute("transform",b)},h=function(){return'@import url("'+c.settings.css.stylesheetUrl+'");'},i=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.gestureStart,[this,a])},j=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.gestureMove,[this,a])},l=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.gestureEnd,[this,a])},m=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.dragStart,[this,a])},n=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.dragMove,[this,a])},o=function(a){a.target===this._privates(e).root&&this.fire(c.Graph.ListenerType.dragEnd,[this,a])},p=function(a){this.fire(c.Graph.ListenerType.wheel,[this,a])},q=function(a,b){var c=a._privates(e),d=c.scale*(1+b.detail.ds),f,g;d>0&&(f=c.x,g=c.y,c.enablePanning&&(f+=b.detail.dx/d,g+=b.detail.dy/d),c.enableZooming&&(f-=(b.detail.pageX-c.rootOffset.x)*b.detail.ds/d,g-=(b.detail.pageY-c.rootOffset.y)*b.detail.ds/d,a.scale(d)),a.translate(f,g))},r=function(a,b){var c=a._privates(e);if(!c.enablePanning)return b;c.panPosition=a.translate()},s=function(a,b){var c=a._privates(e);if(!c.enablePanning)return b;if(b.type==="interactdragmove"&&this.highPerformance()||b.type==="interactdragend"&&!this.highPerformance())c.panPosition.x+=b.detail.dx/c.scale,c.panPosition.y+=b.detail.dy/c.scale,this.translate(c.panPosition.x,c.panPosition.y)},t=function(a,b){var c=a._privates(e);if(!c.enableZooming)return b;b.preventDefault();var d=b.wheelDelta||b.detail,f=.2*(d>0?1:-1),g=c.scale*(1+f),h,i;g>0&&d!==0&&(h=c.x,i=c.y,h-=(b.pageX-c.rootOffset.x)*f/g,i-=(b.pageY-c.rootOffset.y)*f/g,a.scale(g),a.translate(h,i))},u=function(){var a=this._privates(e),d=b.createElement("div");a.container.appendChild(d),a.root=b.createElementNS(c.svgns,"svg"),a.root.setAttribute("xmlns",c.svgns),a.root.setAttribute("id",a.id),d.appendChild(a.root);var f=jQuery(a.root).offset();a.rootOffset={x:f.left,y:f.top},a.rootDimensions={width:jQuery(a.root).width(),height:jQuery(a.root).height()},a.defsGroup=b.createElementNS(c.svgns,"defs"),a.root.appendChild(a.defsGroup),a.css=b.createElementNS(c.svgns,"style"),a.css.setAttribute("type","text/css"),a.css.textContent=h(),a.root.appendChild(a.css),a.rootGroup=b.createElementNS(c.svgns,"g"),g.call(this),a.root.appendChild(a.rootGroup),a.nodeGroup=b.createElementNS(c.svgns,"g"),a.rootGroup.appendChild(a.nodeGroup),a.edgeGroup=b.createElementNS(c.svgns,"g"),a.rootGroup.appendChild(a.edgeGroup),a.connectingArcs={},a.cloneMarker=b.createElementNS(c.svgns,"pattern"),a.cloneMarker.setAttribute("id","cloneMarker"),a.cloneMarker.setAttribute("patternUnits","objectBoundingBox"),a.cloneMarker.setAttribute("x","0"),a.cloneMarker.setAttribute("y","70%"),a.cloneMarker.setAttribute("width","1000"),a.cloneMarker.setAttribute("height","100"),a.cloneRect=b.createElementNS(c.svgns,"rect"),a.cloneRect.setAttribute("fill","black"),a.cloneRect.setAttribute("width","1000"),a.cloneRect.setAttribute("height","100"),a.cloneMarker.appendChild(a.cloneRect),a.defsGroup.appendChild(a.cloneMarker),a.stateVarExistence=b.createElementNS(c.svgns,"pattern"),a.stateVarExistence.setAttribute("id","stateVariableExistence"),a.stateVarExistence.setAttribute("patternUnits","objectBoundingBox"),a.stateVarExistence.setAttribute("x","50%"),a.stateVarExistence.setAttribute("y","0"),a.stateVarExistence.setAttribute("width","100"),a.stateVarExistence.setAttribute("height","100"),a.existanceRect=b.createElementNS(c.svgns,"rect"),a.existanceRect.setAttribute("fill","black"),a.existanceRect.setAttribute("width","100"),a.existanceRect.setAttribute("height","100"),a.stateVarExistence.appendChild(a.existanceRect),a.defsGroup.appendChild(a.stateVarExistence),a.stateVarLocation=b.createElementNS(c.svgns,"pattern"),a.stateVarLocation.setAttribute("id","stateVariableLocation"),a.stateVarLocation.setAttribute("patternUnits","objectBoundingBox"),a.stateVarLocation.setAttribute("x","0"),a.stateVarLocation.setAttribute("y","0"),a.stateVarLocation.setAttribute("width","14"),a.stateVarLocation.setAttribute("height","14"),a.locationRect=b.createElementNS(c.svgns,"path"),a.locationRect.setAttribute("d","M0,14 L14,0 M7,7 L14,14 Z"),a.locationRect.setAttribute("style","stroke-width:2;stroke:rgb(0,0,0)"),a.stateVarLocation.appendChild(a.locationRect),a.defsGroup.appendChild(a.stateVarLocation);for(var i in c.connectingArcs)if(c.connectingArcs.hasOwnProperty(i)){var k=c.connectingArcs[i](),l=c.connectingArcs[i].id;a.connectingArcs[l]=k,a.defsGroup.appendChild(k.element),a.defsGroup.appendChild(k.hoverElement)}a.root.addEventListener("mousewheel",p.createDelegate(this)),a.root.addEventListener("interactgesturemove",j.createDelegate(this)),a.root.addEventListener("interactdragstart",m.createDelegate(this)),a.root.addEventListener("interactdragmove",n.createDelegate(this)),a.root.addEventListener("interactdragend",o.createDelegate(this)),interact.set(a.root,{gesture:!0,drag:!0,autoScroll:!1,actionCheck:function(a){return"drag"},checkOnHover:!1})},v=function(a){var b=this._privates(e),c=a.absoluteBottomRight();c.x>b.rootDimensions.width&&(b.rootDimensions.width=c.x+b.x,b.root.setAttribute("width",c.x+b.x)),c.y>b.rootDimensions.height&&(b.rootDimensions.height=c.y+b.y,b.root.setAttribute("height",c.y+b.y))},w=function(a){delete this._privates(e).drawables[a.id()]};c.Graph=function(a){c.Graph.superClazz.call(this),this._addType(c.Graph.ListenerType);var g=this._privates(e);g.id=c.settings.idPrefix.graph+d++,g.container=a,a==null&&(console.error("Warning: Invalid container element specified. Using document.body instead."),g.container=b.body),g.drawables={},g.idCounter=0,g.scale=1,g.x=0,g.y=0,g.enablePanning=!0,g.enableZooming=!0,g.highPerformance=c.settings.initialHighPerformance,this.bind(c.Graph.ListenerType.dragStart,r.createDelegate(this),f(this)),this.bind(c.Graph.ListenerType.dragMove,s.createDelegate(this),f(this)),this.bind(c.Graph.ListenerType.dragEnd,s.createDelegate(this),f(this)),this.bind(c.Graph.ListenerType.gestureMove,q.createDelegate(this),f(this)),this.bind(c.Graph.ListenerType.wheel,t.createDelegate(this),f(this)),u.call(this)},c.Graph.prototype={id:function(){return this._privates(e).id},htmlTopLeft:function(){return this._privates(e).rootOffset},topLeft:function(){return{x:0,y:0}},absolutePosition:function(){return{x:0,y:0}},container:function(){return this._privates(e).container},edgeGroup:function(){return this._privates(e).edgeGroup},nodeGroup:function(){return this._privates(e).nodeGroup},suspendRedraw:function(a){return c.settings.staticSVG?0:this._privates(e).root.suspendRedraw(a)},unsuspendRedraw:function(a){if(c.settings.staticSVG)return;return a!==undefined?this._privates(e).root.unsuspendRedraw(a):this._privates(e).root.unsuspendRedrawAll(),this},enablePanning:function(a){var b=this._privates(e);return a!==undefined?(b.enablePanning!==a&&(b.enablePanning=a),this):b.enablePanning},enableZooming:function(a){var b=this._privates(e);return a!==undefined?(b.enableZooming!==a&&(b.enableZooming=a),this):b.enableZooming},scale:function(a){var b=this._privates(e);return a!==undefined?(a!==b.scale&&(b.scale=a,g.call(this),this.reduceCanvasSize(),this.fire(c.Graph.ListenerType.scale,[this,a])),this):b.scale},translate:function(a,b){var d=this._privates(e);if(a!==undefined&&b!==undefined){if(a!==d.x||b!==d.y)d.x=a,d.y=b,g.call(this),this.reduceCanvasSize(),this.fire(c.Graph.ListenerType.translate,[this,a,b]);return this}return{x:d.x,y:d.y}},fitToPage:function(){var b=this._privates(e).rootDimensions;this.translate(0,0);var c=$(a).width(),d=$(a).height(),f=Math.min(c/b.width,d/b.height);return this.scale(f),this},add:function(a,b,d){var g=this._privates(e),h=null,i=g.idCounter++;return d===undefined&&(d={}),b==undefined?d.id="drawable"+i:d.id=b,d.graph=this,h=new a(d),g.drawables[h.id()]=h,h.bind(c.Drawable.ListenerType.remove,w.createDelegate(this),f(this)),h.bottomRight!==undefined&&(h.bind(c.Node.ListenerType.position,this.reduceCanvasSize.createDelegate(this),f(this)),h.bind(c.Node.ListenerType.size,this.reduceCanvasSize.createDelegate(this),f(this)),this.reduceCanvasSize.call(this,h)),this.fire(c.Graph.ListenerType.add,[h]),h},clear:function(){var a=this._privates(e);for(var b in a.drawables)a.drawables[b].remove()},reduceCanvasSize:function(){var a=this._privates(e),b=Number.MIN_VALUE,d=Number.MIN_VALUE;for(var f in a.drawables)if(a.drawables.hasOwnProperty(f)){var g=a.drawables[f];if(g.bottomRight!==undefined){var h=g.absoluteBottomRight();b=Math.max(b,h.x+a.x),d=Math.max(d,h.y+a.y)}}var i=c.settings.style.graphReduceCanvasPadding;b=Math.max((b+i)*a.scale,i),d=Math.max((d+i)*a.scale,i),a.rootDimensions.width=b,a.root.setAttribute("width",b),a.rootDimensions.height=d*a.scale,a.root.setAttribute("height",d)},connectingArcs:function(){return this._privates(e).connectingArcs},rawSVG:function(){var a=this._privates(e).root.parentNode.innerHTML,b="";return jQuery.ajax({url:c.settings.css.stylesheetUrl,async:!1,dataType:"text",success:function(a){b=a}}),a=a.replace(h(),b),a},cssSVG:function(a){var b=this._privates(e).root.parentNode.innerHTML;return b=b.replace(h(),a),b},highPerformance:function(a){var b=this._privates(e);return a!==undefined?(b.highPerformance=a,this):b.highPerformance},drawables:function(){return this._privates(e).drawables},toJSON:function(a){var b={sbgnlang:c.settings.SBGNlang},d=[],f=[],g=c.settings.dataFormat;k(b,g.nodes,f),k(b,g.edges,d);var h=this._privates(e).drawables;for(var i in h)if(h.hasOwnProperty(i)&&h[i].includeInJSON!==!1){var j=h[i];j.drawableType()==="node"?f.push(j.toJSON()):d.push(j.toJSON())}return b},reduceTopLeftWhitespace:function(a){a=a||0;var b=c.settings.style.graphReduceCanvasPadding,d=this._privates(e),f=Number.MAX_VALUE,g=Number.MAX_VALUE,h,i,j;for(h in d.drawables)d.drawables.hasOwnProperty(h)&&(i=d.drawables[h],i.bottomRight!==undefined&&(j=i.absolutePosition(),f=Math.min(f,j.x),g=Math.min(g,j.y)));f=Math.max(f-b,0)*-1,g=Math.max(g-b,0)*-1;if(f!==0||g!==0)for(h in d.drawables)d.drawables.hasOwnProperty(h)&&(i=d.drawables[h],i.bottomRight!==undefined&&i.hasParent()===!1&&(j=i.position(),i.move(f,g,a)));return this}},c.util.setSuperClass(c.Graph,c.Observable),c.Graph.ListenerType={add:c.util.createListenerTypeId(),scale:c.util.createListenerTypeId(),translate:c.util.createListenerTypeId(),dragStart:c.util.createListenerTypeId(),dragMove:c.util.createListenerTypeId(),dragEnd:c.util.createListenerTypeId(),gestureStart:c.util.createListenerTypeId(),gestureMove:c.util.createListenerTypeId(),gestureEnd:c.util.createListenerTypeId(),wheel:c.util.createListenerTypeId()}}(bui),function(a){var b="bui.Drawable",c=function(a){return b+a.id()};a.Drawable=function(c){a.Drawable.superClazz.call(this),this._addType(a.Drawable.ListenerType);var d=this._privates(b);d.id=c.id,d.graph=c.graph,d.classes=[],d.visible=!1,d.select=!1,d.json=null},a.Drawable.prototype={id:function(){return this._privates(b).id},graph:function(){return this._privates(b).graph},remove:function(){this.fire(a.Drawable.ListenerType.remove,[this]),this.unbind()},select:function(c){var d=this._privates(b);return c!==undefined?(d.select!==c&&(d.select=c,this.fire(a.Drawable.ListenerType.select,[this,c])),this):d.select},visible:function(c){var d=this._privates(b);return c!==undefined?(d.visible!==c&&(d.visible=c,this.fire(a.Drawable.ListenerType.visible,[this,c])),this):d.visible},isSameGraph:function(a){return this._privates(b).graph.id()==node._privates(b).graph.id()},addClass:function(c){var d=this._privates(b).classes,e=!1;for(var f=0;f<arguments.length;f++)c=arguments[f],d.indexOf(c)==-1&&(d.push(c),e=!0);return e===!0&&this.fire(a.Drawable.ListenerType.classes,[this,this.classString()]),this},hasClass:function(a){var c=this._privates(b).classes;return c.indexOf(a)!=-1},removeClass:function(c){if(c===undefined)this._privates(b).classes=[],this.fire(a.Drawable.ListenerType.classes,[this,""]);else{var d=this._privates(b).classes,e=d.indexOf(c);e!=-1&&(d.splice(e,1),this.fire(a.Drawable.ListenerType.classes,[this,this.classString()]))}return this},classString:function(){return this._privates(b).classes.join(" ")},json:function(a){var c=this._privates(b);return a!==undefined?(c.json=a,this):c.json},updateJson:function(a,c){var d=this._privates(b);return d.json=d.json||{},k(d.json,a,c),this},toJSON:function(){var c={},d=this._privates(b),e=a.settings.dataFormat.drawable;return k(c,e.id,d.id),k(c,e.visible,d.visible),k(c,e.cssClasses,d.classes),c},drawableType:function(){return this.bottomRight!==undefined?"node":"edge"},identifier:function(){return this.identifier}},a.util.setSuperClass(a.Drawable,a.Observable),a.Drawable.ListenerType={visible:a.util.createListenerTypeId(),remove:a.util.createListenerTypeId(),select:a.util.createListenerTypeId(),classes:a.util.createListenerTypeId()}}(bui),function(a){var c="bui.Node",d=function(a){return c+a.id()},e=function(){var b=this._privates(c),d=this.absolutePosition(),e=["translate(",d.x.toString(),",",d.y.toString(),")"].join("");b.nodeGroup.setAttributeNS(null,"transform",e),this.fire(a.Node.ListenerType.absolutePosition,[this,d.x,d.y])},f=function(){var a=this._privates(c),b=a.nodeGroup;interact.unset(b),b.removeEventListener("interactdragstart",a.interact.dragStart),b.removeEventListener("interactdragmove",a.interact.dragMove),b.removeEventListener("interactdragend",a.interact.dragMove),b.removeEventListener("interactresizestart",a.interact.resizeStart),b.removeEventListener("interactresizemove",a.interact.resizeMove),b.removeEventListener("interactresizeend",a.interact.resizeMove),b.parentNode.removeChild(b)},g=function(){this.parent(this.graph()),this.remove()},h=function(b,c,f){f!==this.graph()&&f.unbindAll(d(this)),c.bind(a.Drawable.ListenerType.remove,g.createDelegate(this),d(this)),c.bind(a.Node.ListenerType.absolutePosition,e.createDelegate(this),d(this)),e.call(this)},i=function(a,b){var d=this._privates(c).nodeGroup;d.setAttributeNS(null,"class",b)},l=function(b,c){c===!0?this.addClass(a.settings.css.classes.selected):this.removeClass(a.settings.css.classes.selected)},n=function(b){this.fire(a.Node.ListenerType.click,[this,b])},o=function(b){this.fire(a.Node.ListenerType.dragStart,[this,b])},p=function(b){this.fire(a.Node.ListenerType.dragMove,[this,b])},q=function(b){this.fire(a.Node.ListenerType.dragEnd,[this,b])},r=function(b){this.fire(a.Node.ListenerType.resizeStart,[this,b])},s=function(b){this.fire(a.Node.ListenerType.resizeMove,[this,b])},u=function(b){this.fire(a.Node.ListenerType.resizeEnd,[this,b])},v=function(b){if(!a.settings.enableModificationSupport)return"";var c=this.absolutePosition(),d=this.size(),e=this.graph().scale(),f=this.graph().htmlTopLeft(),g=this.graph().translate(),h=interact.margin(),i=((b.touches?b.touches[0]:b).pageX-f.x)/e-g.x,j=((b.touches?b.touches[0]:b).pageY-f.y)/e-g.y,k=i-c.x>d.width-h,l=j-c.y>d.height-h,m=(k?"x":"")+(l?"y":""),n=m&&this._enableResizing?"resize"+m:"drag";return n},w=function(a,b){var d=a._privates(c);d.dragPosition=a.position()},x=function(a,b){var d=a._privates(c),e=a.graph().scale();if(b.type==="interactdragmove"&&a.graph().highPerformance()||b.type==="interactdragend"&&!a.graph().highPerformance())d.dragPosition.x+=b.detail.dx/e,d.dragPosition.y+=b.detail.dy/e,this.position(d.dragPosition.x,d.dragPosition.y)},y=function(a,b){var d=a._privates(c);d.resizeSize=a.size()},z=function(a,b){var d=this._privates(c),e=this.graph().scale();if(b.type==="interactresizemove"&&this.graph().highPerformance()||b.type==="interactresizeend"&&!this.graph().highPerformance())d.resizeSize.width+=b.detail.dx/e,d.resizeSize.height+=b.detail.dy/e,this.size(d.resizeSize.width,d.resizeSize.height)},A=function(){var d=this._privates(c);d.nodeGroup=b.createElementNS(a.svgns,"g"),d.nodeGroup.setAttributeNS(null,"id",this.id()),this.graph().nodeGroup().appendChild(d.nodeGroup),e.call(this),jQuery(d.nodeGroup).click(n.createDelegate(this)),d.nodeGroup.addEventListener("interactdragstart",d.interact.dragStart),d.nodeGroup.addEventListener("interactdragmove",d.interact.dragMove),d.nodeGroup.addEventListener("interactdragend",d.interact.dragMove),d.nodeGroup.addEventListener("interactresizestart",d.interact.resizeStart),d.nodeGroup.addEventListener("interactresizemove",d.interact.resizeMove),d.nodeGroup.addEventListener("interactresizeend",d.interact.resizeMove),a.settings.enableModificationSupport&&interact.set(d.nodeGroup,{drag:this._enableDragging,resize:this._enableResizing,squareResize:this._forceRectangular,actionChecker:d.interact.actionCheck})};a.Node=function(b){a.Node.superClazz.call(this,b),this._addType(a.Node.ListenerType);var g=this._privates(c);g.x=0,g.y=0,g.dragPosition=this.position(),g.resizeSize=this.size(),g.width=this._minWidth,g.height=this._minHeight,g.parent=this.graph(),g.children=[],g.interact={actionCheck:v.createDelegate(this),dragStart:o.createDelegate(this),dragMove:p.createDelegate(this),dragEnd:q.createDelegate(this),resizeStart:r.createDelegate(this),resizeMove:s.createDelegate(this),resizeEnd:u.createDelegate(this)},this.bind(a.Drawable.ListenerType.remove,f.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.parent,h.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.position,e.createDelegate(this),d(this)),this.bind(a.Drawable.ListenerType.classes,i.createDelegate(this),d(this)),this.bind(a.Drawable.ListenerType.select,l.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.dragStart,w.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.dragMove,x.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.dragEnd,x.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.resizeStart,y.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.resizeMove,z.createDelegate(this),d(this)),this.bind(a.Node.ListenerType.resizeEnd,z.createDelegate(this),d(this)),A.call(this)},a.Node.prototype={identifier:function(){return c},_minWidth:1,_minHeight:1,_forceRectangular:!1,_enableResizing:!0,_enableDragging:!0,nodeGroup:function(){return this._privates(c).nodeGroup},position:function(b,d){var e=this._privates(c);if(b!==undefined&&d!==undefined){var f=e.x!==b||e.y!==d;return e.x=b,e.y=d,f&&this.fire(a.Node.ListenerType.position,[this,e.x,e.y]),this}return{x:e.x,y:e.y}},positionCenter:function(a,b){var c=this.size();if(a!==undefined&&b!==undefined)return this.position(a-c.width/2,b-c.height/2),this;var d=this.position();return{x:d.x+c.width/2,y:d.y+c.height/2}},absolutePosition:function(a,b){var d=this._privates(c),e=d.parent.absolutePosition();return a!==undefined&&b!==undefined?(a-=e.x,b-=e.y,this.position(a,b),this):{x:e.x+d.x,y:e.y+d.y}},absolutePositionCenter:function(a,b){var c=this.size();if(a!==undefined&&b!==undefined)return this.absolutePosition(a-c.width/2,b-c.height/2),this;var d=this.absolutePosition();return{x:d.x+c.width/2,y:d.y+c.height/2}},htmlTopLeft:function(){var a=this._privates(c),b=a.parent.htmlTopLeft();return{x:b.x+a.x,y:b.y+a.y}},size:function(b,d){var e=this._privates(c);if(b!==undefined&&d!==undefined){b=Math.max(this._minWidth,b),d=Math.max(this._minHeight,d),this._forceRectangular===!0&&(d=b);var f=e.width!==b||e.height!==d;return e.width=b,e.height=d,f&&this.fire(a.Node.ListenerType.size,[this,e.width,e.height]),this}return{width:e.width,height:e.height}},topLeft:function(a,b){var d=this._privates(c);return a!==undefined&&b!==undefined?(d.x=a,d.y=b,this):{x:d.x,y:d.y}},bottomRight:function(a,b){var d=this._privates(c);return a!==undefined&&b!==undefined?(d.x=a-d.width,d.y=b-d.height,this):{x:d.x+d.width,y:d.y+d.height}},absoluteBottomRight:function(a,b){var d=this._privates(c),e=this.absolutePosition();return a!==undefined&&b!==undefined&&this.absolutePosition(a-d.width,b-d.height),{x:e.x+d.width,y:e.y+d.height}},center:function(){var a=this._privates(c);return{x:a.x+a.width/2,y:a.y+a.height/2}},absoluteCenter:function(){var a=this._privates(c),b=this.absolutePosition();return{x:b.x+a.width/2,y:b.y+a.height/2}},move:function(b,d,e,f){var g=this._privates(c);if(e===undefined||e<=0)this.position(g.x+b,g.y+d);else{var h=this,i=1e3/a.settings.animationFPS,j=Math.floor(e/i);(function(){var a=b/j,c=d/j;h.position(g.x+a,g.y+c),j--,j>=1?(b-=a,d-=c,setTimeout(arguments.callee,i)):f&&f()})()}return this},resize:function(b,d,e){var f=this._privates(c);if(e===undefined||e<=0)this.size(b,d);else{var g=this,h=1e3/a.settings.animationFPS,i=Math.floor(e/h),j=(b-f.width)/i,k=(d-f.height)/i;(function(){g.size(b-i*j,d-i*k),i--,i>=1&&setTimeout(arguments.callee,h)})()}return this},moveAbsolute:function(a,b,d){var e=this._privates(c);return this.move(a-e.x,b-e.y,d)},moveAbsoluteCenter:function(a,b,c){var d=this.size();this.moveAbsolute(a-d.width/2,b-d.height/2)},parent:function(b){var d=this._privates(c);if(b!==undefined){if(b!==d.parent){var e=d.parent;d.parent=b,e!==this.graph()&&e._removeChild(this),b!==this.graph()&&b._addChild(this),this.fire(a.Node.ListenerType.parent,[this,b,e])}return this}return d.parent},hasParent:function(){return this.parent()!==this.graph()},addChild:function(a){return a.parent(this),this},removeChild:function(a){return a.parent(this.graph()),this},_addChild:function(a){this._privates(c).children.push(a)},_removeChild:function(a){var b=this._privates(c).children,d=b.indexOf(a);d!==-1&&b.splice(d,1)},children:function(a){var b=[],d=this._privates(c).children;for(var e=0;e<d.length;e++){var f=d[e];(a===undefined||a(f)===!0)&&b.push(f)}return b},auxiliaryUnits:function(){return this.children(function(a){return a.auxiliaryUnit===!0})},childrenWithoutAuxiliaryUnits:function(){return this.children(function(a){return a.auxiliaryUnit!==!0})},calculateLineEnd:function(b){if(this.visible()===!1)return this.center();var c=this.absoluteCenter(),d=this.size(),e=b.absoluteCenter(),f=a.settings.style.edgeToNodePadding,g=d.width+f.leftRight*2,h=d.height+f.topBottom*2,i=e.x-c.x,j=e.y-c.y;if(i==0&&j==0)return this.center();var k=Math.abs(Math.atan(j/i)),l=Math.atan(h/g),m=0,n=k<l;n?m=g/2:(m=h/2,k=Math.PI/2-k);var o=this._calculationHook(m,k),p=o.opposite;m=o.adjacent;var q=0,r=0;n?(q=m,r=p):(q=p,r=m);var s=c.y>e.y,t=c.x>e.x;return q*=t?-1:1,r*=s?-1:1,{x:c.x+q,y:c.y+r}},_calculationHook:function(a,b){return{adjacent:a,opposite:Math.tan(b)*a}},startDragging:function(a,b){return jQuery(this.nodeGroup()).simulate("mousedown",{pageX:a,pageY:b}),this},positionAuxiliaryUnits:function(){var b=this.auxiliaryUnits(),c=a.settings.style.automaticAuxiliaryUnitPositioning,d=this.size();for(var e=0;e<b.length&&e<c.length;e++){var f=b[e],g=c[e],h=f.size();f.positionCenter(d.width*g[0],d.height*g[1])}return this},toJSON:function(){var b=a.Node.superClazz.prototype.toJSON.call(this),d=a.settings.dataFormat,e=this._privates(c),f=this.absolutePosition(),g;k(b,d.drawable.sbo,t(m,this)),k(b,d.node.x,f.x),k(b,d.node.y,f.y),k(b,d.node.width,e.width),k(b,d.node.height,e.height);var h=this.childrenWithoutAuxiliaryUnits();if(h.length>0){var i=[];k(b,d.node.subNodes,i);for(g=0;g<h.length;g++)i.push(h[g].id())}var l=this.auxiliaryUnits();if(l.length>0){var n=[];for(g=0;g<l.length;g++){var o=l[g];o instanceof a.StateVariable||o instanceof a.StateVariableER?n.push(o.toJSON()):j("Warning: Can't export units of information to JSON.")}k(b,d.node.statevariable,n)}return b},toFront:function(){var a=this._privates(c).nodeGroup;return a.parentNode.appendChild(a),this},toBack:function(){var a=this._privates(c).nodeGroup,b=a.parentNode;return b.insertBefore(a,b.firstChild),this}},a.util.setSuperClass(a.Node,a.Drawable),a.Node.ListenerType={parent:a.util.createListenerTypeId(),position:a.util.createListenerTypeId(),absolutePosition:a.util.createListenerTypeId(),size:a.util.createListenerTypeId(),click:a.util.createListenerTypeId(),dragStart:a.util.createListenerTypeId(),dragMove:a.util.createListenerTypeId(),dragEnd:a.util.createListenerTypeId(),resizeStart:a.util.createListenerTypeId(),resizeMove:a.util.createListenerTypeId(),resizeEnd:a.util.createListenerTypeId()}}(bui),function(a){var c="bui.Labelable",d=function(a){return c+a.id()},e=function(d){var e=this._privates(c),f=0,g=d[0].maxHeight,h=0;for(var i=0;i<d.length;i++){var j=d[i],k=[];h+=j.maxHeight;for(var l=0;l<j.words.length;l++)k.push(j.words[l].word);var m=b.createElementNS(a.svgns,"tspan");m.appendChild(b.createTextNode(k.join(" "))),m.setAttributeNS(null,"x",j.horizontalIndention),m.setAttributeNS(null,"dy",f),m.style.setProperty("fill",e.color.label),e.labelElement.appendChild(m),f=j.maxHeight}e.labelElement.setAttributeNS(null,"y",this.size().height/2+g-h/2)},f=function(d){var e=this._privates(c),f=[],g=Number.MIN_VALUE,h=0;for(var i=0;i<d.length;i++){var j=d[i];for(var k=0;k<j.words.length;k++)f.push(j.words[k].word);h+=j.totalWidth+j.spaceWidth,g=Math.max(g,j.maxHeight)}h-=d[0].spaceWidth,e.labelElement.appendChild(b.createTextNode(f.join(" ")));var l=a.settings.style.adaptToLabelNodePadding;h+=l.left+l.right;var m=g+l.top+l.bottom;this.size(h,m),e.labelElement.setAttributeNS(null,"x",l.left),e.labelElement.setAttributeNS(null,"y",g),e.labelElement.style.setProperty("fill",e.color.label)},g=function(){var d=this._privates(c),g=this.label();d.labelElement!==null&&d.labelElement.parentNode!==null&&d.labelElement.parentNode.removeChild(d.labelElement);if(g.length===0)return;d.labelElement=b.createElementNS(a.svgns,"text");var h=a.util.calculateLabelPositioning(this.size().width,g,d.calculationClasses);d.adaptSizeToLabel===!0?f.call(this,h):e.call(this,h),d.labelElement.setAttributeNS(null,"class",d.svgClasses),this.nodeGroup().appendChild(d.labelElement)};a.Labelable=function(){a.Labelable.superClazz.apply(this,arguments),this._addType(a.Labelable.ListenerType);var b=this._privates(c);b.label=this._label,b.adaptSizeToLabel=this._adaptSizeToLabel,b.labelElement=null,b.color={background:"",label:"",border:""},b.svgClasses=this._svgClasses,b.calculationClasses=this._calculationClasses;var e=g.createDelegate(this);this.bind(a.Labelable.ListenerType.label,e,d(this)),this.bind(a.Labelable.ListenerType.color,e,d(this)),this.bind(a.Labelable.ListenerType.adaptSizeToLabel,e,d(this)),this.bind(a.Labelable.ListenerType.labelClass,e,d(this)),this.bind(a.Node.ListenerType.size,e,d(this))},a.Labelable.prototype={identifier:function(){return c},_label:"",_adaptSizeToLabel:!1,_svgClasses:"",_ignLabelSize:!1,_calculationClasses:[a.settings.css.classes.textDimensionCalculation.standard],label:function(b){var d=this._privates(c);return b!==undefined?(b=b===null?"":b,b!=d.label&&(d.label=b,this.fire(a.Labelable.ListenerType.label,[this,b])),this):d.label},color:function(b){var d=this._privates(c),e=!1;return!b||!(b.background||b.label||b.border)?d.color:(typeof b.background=="string"&&(b.background=b.background.toLowerCase(),e=e||b.background!==d.color.background,d.color.background=b.background),typeof b.label=="string"&&(b.label=b.label.toLowerCase(),e=e||b.label!==d.color.label,d.color.label=b.label),typeof b.border=="string"&&(b.border=b.border.toLowerCase(),e=e||b.border!==d.color.border,d.color.border=b.border),e&&this.fire(a.Labelable.ListenerType.color,[this,b]),this)},adaptSizeToLabel:function(b){var d=this._privates(c);return b!==undefined?(b!==d.adaptSizeToLabel&&(d.adaptSizeToLabel=b,this.fire(a.Labelable.ListenerType.adaptSizeToLabel,[this,b])),this):d.adaptSizeToLabel},labelClass:function(b,d){var e=this._privates(c);return e.svgClasses=b,e.calculationClasses=d,this.fire(a.Labelable.ListenerType.labelClass,[this]),this},sizeBasedOnLabel:function(){var b=this._privates(c),d=a.util.calculateLabelPositioning(300,this.label(),b.calculationClasses),e=Number.MIN_VALUE,f=Number.MIN_VALUE;for(var g=0;g<d.length;g++){var h=d[g];f=Math.max(f,h.totalWidth),e=Math.max(e,h.maxHeight)}var i=a.settings.style.adaptToLabelNodePadding;return f+=i.left+i.right,e+=i.top+i.bottom,{width:f,height:e}},toJSON:function(){var b=a.Labelable.superClazz.prototype.toJSON.call(this),d=this._privates(c),e=a.settings.dataFormat;return k(b,e.node.label,d.label),b}},a.util.setSuperClass(a.Labelable,a.Node),a.Labelable.ListenerType={label:a.util.createListenerTypeId(),adaptSizeToLabel:a.util.createListenerTypeId(),labelClass:a.util.createListenerTypeId(),color:a.util.createListenerTypeId()}}(bui),function(a){var c="bui.EdgeHandle",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d)},f=function(){var d=this._privates(c);d.circle=b.createElementNS(a.svgns,"circle"),e.call(this,this,this.size().width),this.nodeGroup().appendChild(d.circle)};a.EdgeHandle=function(){a.EdgeHandle.superClazz.apply(this,arguments),this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),f.call(this);var b=a.settings.style.edgeHandleRadius*2;this.size(b,b)},a.EdgeHandle.prototype={identifier:function(){return c},includeInJSON:!1,_circle:null,_forceRectangular:!0,_enableResizing:!1,_calculationHook:h},a.util.setSuperClass(a.EdgeHandle,a.Node)}(bui),function(a){var c="bui.Association",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d)},f=function(){var d=this._privates(c);d.circle=b.createElementNS(a.svgns,"circle"),e.call(this,this,this.size().width),this.nodeGroup().appendChild(d.circle)};a.Association=function(){a.Association.superClazz.apply(this,arguments),this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),f.call(this);var b=a.settings.style.edgeHandleRadius*2;this.size(b,b),this.addClass("Outcome")},a.Association.prototype={identifier:function(){return"Association"},includeInJSON:!1,_circle:null,_forceRectangular:!0,_enableResizing:!1,_minWidth:14,_minHeight:14,_calculationHook:h},a.util.setSuperClass(a.Association,a.Node)}(bui),function(a){var c="bui.Dissociation",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d),e.subcircle.setAttributeNS(null,"cx",d),e.subcircle.setAttributeNS(null,"cy",d),e.subcircle.setAttributeNS(null,"r",b/4)},f=function(){var d=this._privates(c);d.circle=b.createElementNS(a.svgns,"circle"),d.subcircle=b.createElementNS(a.svgns,"circle"),e.call(this,this,this.size().width),this.nodeGroup().appendChild(d.circle),this.nodeGroup().appendChild(d.subcircle)};a.Dissociation=function(){a.Dissociation.superClazz.apply(this,arguments),this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),f.call(this);var b=a.settings.style.edgeHandleRadius*2;this.size(b,b)},a.Dissociation.prototype={identifier:function(){return"Dissociation"},includeInJSON:!1,_circle:null,_forceRectangular:!0,_enableResizing:!1,_minWidth:14,_minHeight:14,_calculationHook:h},a.util.setSuperClass(a.Dissociation,a.Node)}(bui),function(a){var c="bui.LogicalOperator",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d)},f=function(){var a=this._privates(c),b=this.color();a.circle.style.setProperty("fill",b.background),a.circle.style.setProperty("stroke",b.border)},g=function(){var d=this._privates(c);d.circle=b.createElementNS(a.svgns,"circle"),e.call(this,this,this.size().width),f.call(this,this,this.color()),this.nodeGroup().appendChild(d.circle)};a.LogicalOperator=function(b){a.LogicalOperator.superClazz.apply(this,arguments);var c=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,c,d(this)),g.call(this),typeof b=="string"?b=="delay"?this.label("τ"):this.label(b):typeof b=="object"&&(b==174?this.label("OR"):b==173?this.label("AND"):b==238?this.label("NOT"):b==225&&this.label("τ")),this.label()=="τ"&&this.addClass("delay"),this.addClass("LogicalOperator");var h=a.settings.style.edgeHandleRadius*2;this.size(h,h)},a.LogicalOperator.prototype={identifier:function(){return c},_minWidth:14,_minHeight:14,includeInJSON:!0,_circle:null,_forceRectangular:!0,_enableResizing:!1,_calculationHook:h},a.util.setSuperClass(a.LogicalOperator,a.Labelable)}(bui),function(a){a.SplineEdgeHandle=function(){a.SplineEdgeHandle.superClazz.apply(this,arguments),this.addClass(a.settings.css.classes.splineEdgeHandle),this.position(10,10)},a.SplineEdgeHandle.prototype={includeInJSON:!1},a.util.setSuperClass(a.SplineEdgeHandle,a.EdgeHandle)}(bui),function(a){var c="bui.RectangularNode",d=function(a,b,c,d,e,f,g){return[a,",",b," ",c," ",d,",",e," ",f,",",g].join("")},e=function(a,b,c,e){var f=[];return f.push("M"+a/2+","+0),f.push("H"+(a-c)),c>0&&f.push("A"+d(c,c,0,0,1,a,c)),f.push("V"+(b-e)),e>0&&f.push("A"+d(e,e,0,0,1,a-e,b)),f.push("H"+e),e>0&&f.push("A"+d(e,e,0,0,1,0,b-e)),f.push("V"+c),c>0&&f.push("A"+d(c,c,0,0,1,c,0)),f.push("Z"),f.join(" ")},f=function(a){return c+a.id()},g=function(){var a=this._privates(c),b=this.size();a.rect.setAttributeNS(null,"d",e(b.width,b.height,a.topRadius,a.bottomRadius))},h=function(){var a=this._privates(c),b=this.color();a.rect.style.setProperty("fill",b.background),a.rect.style.setProperty("stroke",b.border)},i=function(){var d=this.nodeGroup(),e=this._privates(c);e.rect=b.createElementNS(a.svgns,"path");var f=this.size();g.call(this,this,f.width,f.height),h.call(this,this,this.color()),d.appendChild(e.rect)};a.RectangularNode=function(){a.RectangularNode.superClazz.apply(this,arguments),this._addType(a.RectangularNode.ListenerType);var b=g.createDelegate(this),d=h.createDelegate(this);this.bind(a.Node.ListenerType.size,b,f(this)),this.bind(a.RectangularNode.ListenerType.topRadius,b,f(this)),this.bind(a.RectangularNode.ListenerType.bottomRadius,b,f(this)),this.bind(a.Labelable.ListenerType.color,d,f(this));var e=this._privates(c);e.topRadius=0,e.bottomRadius=0,i.call(this),this.addClass(a.settings.css.classes.rectangle)},a.RectangularNode.prototype={identifier:function(){return c},topRadius:function(b){var d=this._privates(c);return b!==undefined?(d.topRadius!==b&&(d.topRadius=b,this.fire(a.RectangularNode.ListenerType.topRadius,[this,b])),this):d.topRadius},bottomRadius:function(b){var d=this._privates(c);return b!==undefined?(d.bottomRadius!==b&&(d.bottomRadius=b,this.fire(a.RectangularNode.ListenerType.bottomRadius,[this,b])),this):d.bottomRadius}},a.util.setSuperClass(a.RectangularNode,a.Labelable),a.RectangularNode.ListenerType={topRadius:a.util.createListenerTypeId(),bottomRadius:a.util.createListenerTypeId()}}(bui),function(a){var b="bui.UnitOfInformation",c=function(a){return b+a.id()};a.UnitOfInformation=function(){a.UnitOfInformation.superClazz.apply(this,arguments),this.labelClass(a.settings.css.classes.smallText,[a.settings.css.classes.textDimensionCalculation.small]),this.adaptSizeToLabel(!0)},a.UnitOfInformation.prototype={auxiliaryUnit:!0,includeInJSON:!1,_enableResizing:!1},a.util.setSuperClass(a.UnitOfInformation,a.RectangularNode)}(bui),function(a){var b="bui.Macromolecule";a.Macromolecule=function(){a.Macromolecule.superClazz.apply(this,arguments),this.topRadius(a.settings.style.nodeCornerRadius),this.bottomRadius(a.settings.style.nodeCornerRadius)},a.Macromolecule.prototype={identifier:function(){return b},_minWidth:60,_minHeight:60},a.util.setSuperClass(a.Macromolecule,a.RectangularNode)}(bui),function(a){var c="bui.VariableValue",d=function(a){return c+a.id()},e=function(a,b,d){var e=["M",d/2,d,"L",b-d/2,d,"C",b+d/4,d,b+d/4,0,b-d/2,0,"L",d/2,0,"C",-d/4,0,-d/4,d,d/2,d,"Z"].join(" ");this._privates(c).path.setAttributeNS(null,"d",e)},f=function(){var a=this._privates(c),b=this.color();a.path.style.setProperty("fill",b.background),a.path.style.setProperty("stroke",b.border)},g=function(){var d=this.nodeGroup(),g=this.size(),h=this._privates(c);h.path=b.createElementNS(a.svgns,"path"),e.call(this,this,g.width,g.height),f.call(this,this,this.color()),d.appendChild(h.path)};a.VariableValue=function(){a.VariableValue.superClazz.apply(this,arguments);var b=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,b,d(this)),g.call(this),this.labelClass(a.settings.css.classes.smallText,[a.settings.css.classes.textDimensionCalculation.small]),this.addClass("VariableValue");var h=this._privates(c)},a.VariableValue.prototype={identifier:function(){return c},_minWidth:10,_minHeight:14,_enableResizing:!0,_adaptSizeToLabel:!1},a.util.setSuperClass(a.VariableValue,a.Labelable)}(bui),function(a){var c="bui.Complex",d=function(a){return c+a.id()},e=function(b,d,e){var f=a.settings.style.complexCornerRadius,g=["M",d/2,0,"H",d-f,"L",d,f,"V",e-f,"L",d-f,e,"H",f,"L",0,e-f,"V",f,"L",f,0,"H",d/2].join(" ");this._privates(c).path.setAttributeNS(null,"d",g)},f=function(){var d=this.nodeGroup(),f=this.size(),g=this._privates(c);g.path=b.createElementNS(a.svgns,"path"),e.call(this,this,f.width,f.height),d.appendChild(g.path)};a.Complex=function(){a.Node.apply(this,arguments),this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),f.call(this),this.addClass(a.settings.css.classes.complex)},a.Complex.prototype={identifier:function(){return"Complex"},_minWidth:90,_minHeight:90,tableLayout:function(b){b===undefined&&(b=a.settings.style.complexTableLayout),b.showBorder===!0?this.removeClass(a.settings.css.classes.hideBorder):this.addClass(a.settings.css.classes.hideBorder);var c=[[]],d=this.childrenWithoutAuxiliaryUnits(),e=Math.max(1,Math.round(Math.sqrt(d.length))),f;if(b.restrictNumberOfColumns===!0)f=function(a){var b=c[c.length-1];b.length===e&&(b=[],c.push(b)),b.push(a)};else{var g=0;f=function(a){var b=c[g];b===undefined&&(b=[],c[g]=b),b.push(a),g++,g>=e&&(g=0)}}var h={};for(var i in b)b.hasOwnProperty(i)&&(h[i]=b[i]);h.padding*=.7,h.restrictNumberOfColumns=!h.restrictNumberOfColumns,h.padding<4&&(h.showBorder=!1,h.padding=0);for(var j=0;j<d.length;j++){var k=d[j];k instanceof a.Complex&&k.tableLayout(h),f(k)}var l=Number.MIN_VALUE,m=b.padding;for(var n=0;n<c.length;n++){var o=c[n],p=b.padding,q=Number.MIN_VALUE;for(var r=0;r<o.length;r++){var s=o[r],t=s.size();q=Math.max(t.height,q),s.position(p,m),p+=t.width+b.padding}m+=q+b.padding,l=Math.max(l,p)}this.size(l,m)}},a.util.setSuperClass(a.Complex,a.Node)}(bui),function(a){var c="bui.Perturbation",d=function(a,b,d){var e=["M",b/5,d/2,"L",0,d,"L",b,d,"L",b/5*4,d/2,"L",b,0,"L",0,0,"L",b/5,d/2,"Z"].join(" ");this._privates(c).path.setAttributeNS(null,"d",e)},e=function(){var a=this._privates(c),b=this.color();a.path.style.setProperty("fill",b.background),a.path.style.setProperty("stroke",b.border)},f=function(a){return c+a.id()},g=function(){var f=this.nodeGroup(),g=this.size(),h=this._privates(c);h.path=b.createElementNS(a.svgns,"path"),d.call(this,this,g.width,g.height),e.call(this,this,this.color()),f.appendChild(h.path)};a.Perturbation=function(){a.Perturbation.superClazz.apply(this,arguments);var b=e.createDelegate(this);this.bind(a.Node.ListenerType.size,d.createDelegate(this),f(this)),this.bind(a.Labelable.ListenerType.color,b,f(this)),g.call(this),this.addClass(a.settings.css.classes.perturbation)},a.Perturbation.prototype={identifier:function(){return c},_minWidth:80,_minHeight:60},a.util.setSuperClass(a.Perturbation,a.Labelable)}(bui),function(a){var c="bui.Phenotype",d=function(a,b,d){var e=["M",0,d/2,"L",b/5,d,"L",b/5*4,d,"L",b,d/2,"L",b/5*4,0,"L",b/5,0,"L",0,d/2,"Z"].join(" ");this._privates(c).path.setAttributeNS(null,"d",e)},e=function(){var a=this._privates(c),b=this.color();a.path.style.setProperty("fill",b.background),a.path.style.setProperty("stroke",b.border)},f=function(a){return c+a.id()},g=function(){var f=this.nodeGroup(),g=this.size(),h=this._privates(c);h.path=b.createElementNS(a.svgns,"path"),d.call(this,this,g.width,g.height),e.call(this,this,this.color()),f.appendChild(h.path)};a.Phenotype=function(){a.Phenotype.superClazz.apply(this,arguments);var b=e.createDelegate(this);this.bind(a.Node.ListenerType.size,d.createDelegate(this),f(this)),this.bind(a.Labelable.ListenerType.color,b,f(this));var h=this._privates(c);g.call(this),this.addClass(a.settings.css.classes.perturbation)},a.Phenotype.prototype={identifier:function(){return c},_minWidth:80,_minHeight:60},a.util.setSuperClass(a.Phenotype,a.Labelable)}(bui),function(a){var c="bui.Tag",d=function(a,b,d){var e=["M",0,0,"L",0,d,"L",b/5*4,d,"L",b,d/2,"L",b/5*4,0,"L",0,0,"Z"].join(" ");this._privates(c).path.setAttributeNS(null,"d",e)},e=function(){var a=this._privates(c),b=this.color();a.path.style.setProperty("fill",b.background),a.path.style.setProperty("stroke",b.border)},f=function(a){return c+a.id()},g=function(){var f=this.nodeGroup(),g=this.size(),h=this._privates(c);h.path=b.createElementNS(a.svgns,"path"),d.call(this,this,g.width,g.height),e.call(this,this,this.color()),f.appendChild(h.path)};a.Tag=function(){a.Tag.superClazz.apply(this,arguments);var b=e.createDelegate(this);this.bind(a.Node.ListenerType.size,d.createDelegate(this),f(this)),this.bind(a.Labelable.ListenerType.color,b,f(this));var h=this._privates(c);g.call(this),this.addClass(a.settings.css.classes.perturbation)},a.Tag.prototype={identifier:function(){return c},_minWidth:40,_minHeight:30,orientation:function(a){var b=this.absolutePositionCenter();a=="down"?this._privates(c).path.setAttributeNS(null,"transform","rotate(90,"+b.x+","+b.y+")"):a=="up"?this._privates(c).path.setAttributeNS(null,"transform","rotate(270,"+b.x+","+b.y+")"):a=="left"?this._privates(c).path.setAttributeNS(null,"transform","rotate(180,"+b.x+","+b.y+")"):a!="right"}},a.util.setSuperClass(a.Tag,a.Labelable)}(bui),function(a){var c="bui.Compartment",d=function(a){return c+a.id()},e=function(a,b,d){var e=this._privates(c);e.rect.setAttributeNS(null,"width",b),e.rect.setAttributeNS(null,"height",d)},f=function(){var d=this.nodeGroup(),f=this.size(),g=this._privates(c);g.rect=b.createElementNS(a.svgns,"rect");var h=a.settings.style.compartmentCornerRadius;g.rect.setAttributeNS(null,"rx",h.x),g.rect.setAttributeNS(null,"ry",h.y),e.call(this,this,f.width,f.height),d.appendChild(g.rect)};a.Compartment=function(){a.Compartment.superClazz.apply(this,arguments),this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),f.call(this),this.addClass(a.settings.css.classes.compartment);var b=this.graph().add(a.Labelable).parent(this).visible(!0).adaptSizeToLabel(!0);b.includeInJSON=!1,this._privates(c).label=b},a.Compartment.prototype={identifier:function(){return"Compartment"},_minWidth:90,_minHeight:90,label:function(){var a=this._privates(c).label;return a.label.apply(a,arguments)},labelPosition:function(){var a=this._privates(c).label;return a.position.apply(a,arguments)},toJSON:function(){var b=a.Compartment.superClazz.prototype.toJSON.call(this),d=this._privates(c),e=a.settings.dataFormat;return k(b,e.node.label,d.label.label()),b}},a.util.setSuperClass(a.Compartment,a.Node)}(bui),function(a){var b="bui.NucleicAcidFeature";a.NucleicAcidFeature=function(){a.NucleicAcidFeature.superClazz.apply(this,arguments),this.bottomRadius(a.settings.style.nodeCornerRadius)},a.NucleicAcidFeature.prototype={identifier:function(){return b},_minWidth:60,_minHeight:60},a.util.setSuperClass(a.NucleicAcidFeature,a.RectangularNode)}(bui),function(a){var c="bui.StateVariable",d=function(a){return c+a.id()},e=function(a,b,d){var e=b/2,f=d/2,g=this._privates(c);g.ellipse.setAttributeNS(null,"cx",e),g.ellipse.setAttributeNS(null,"cy",f),g.ellipse.setAttributeNS(null,"rx",e),g.ellipse.setAttributeNS(null,"ry",f)},f=function(){var a=this._privates(c),b=this.color();a.ellipse.style.setProperty("fill",b.background),a.ellipse.style.setProperty("stroke",b.border)},g=function(){var d=this._privates(c);d.ellipse=b.createElementNS(a.svgns,"ellipse");var g=this.size();e.call(this,this,g.width,g.height),f.call(this,this,this.color()),this.nodeGroup().appendChild(d.ellipse)};a.StateVariable=function(){a.StateVariable.superClazz.apply(this,arguments);var b=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,b,d(this)),g.call(this),this.labelClass(a.settings.css.classes.smallText,[a.settings.css.classes.textDimensionCalculation.small]),this.adaptSizeToLabel(!0)},a.StateVariable.prototype={identifier:function(){return c},_minWidth:20,_minHeight:20,auxiliaryUnit:!0,includeInJSON:!1,_enableResizing:!0,toJSON:function(){return this.label()}},a.util.setSuperClass(a.StateVariable,a.Labelable)}(bui),function(a){var b="bui.StateVariableER",c=function(a){return b+a.id()};a.StateVariableER=function(){a.StateVariableER.superClazz.apply(this,arguments),this.labelClass(a.settings.css.classes.smallText,[a.settings.css.classes.textDimensionCalculation.small]),this.addClass(a.settings.css.classes.statevariable)},a.StateVariableER.prototype={identifier:function(){return b},_minWidth:10,_minHeight:14,auxiliaryUnit:!0,includeInJSON:!1,_enableResizing:!0,toJSON:function(){return this.hasClass("existence")?"existence":this.hasClass("location")?"location":this.label()}},a.util.setSuperClass(a.StateVariableER,a.VariableValue)}(bui),function(a){var c="bui.SimpleChemical",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d)},f=function(){var a=this._privates(c),b=this.color();a.circle.style.setProperty("fill",b.background),a.circle.style.setProperty("stroke",b.border)},h=function(){var d=this.nodeGroup(),g=this._privates(c);g.circle=b.createElementNS(a.svgns,"circle"),e.call(this,this,this.size().width),f.call(this,this,this.color()),d.appendChild(g.circle)};a.SimpleChemical=function(){a.SimpleChemical.superClazz.apply(this,arguments);var b=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,b,d(this)),h.call(this)},a.SimpleChemical.prototype={identifier:function(){return c},_minWidth:60,_minHeight:60,_forceRectangular:!0,_calculationHook:g},a.util.setSuperClass(a.SimpleChemical,a.Labelable)}(bui),function(a){var c="bui.UnspecifiedEntity",d=function(a){return c+a.id()},e=function(a,b,d){var e=b/2,f=d/2,g=this._privates(c);g.ellipse.setAttributeNS(null,"cx",e),g.ellipse.setAttributeNS(null,"cy",f),g.ellipse.setAttributeNS(null,"rx",e),g.ellipse.setAttributeNS(null,"ry",f)},f=function(){var a=this._privates(c),b=this.color();a.ellipse.style.setProperty("fill",b.background),a.ellipse.style.setProperty("stroke",b.border)},g=function(){var d=this.nodeGroup(),g=this._privates(c);g.ellipse=b.createElementNS(a.svgns,"ellipse");var h=this.size();e.call(this,this,h.width,h.height),f.call(this,this,this.color()),d.appendChild(g.ellipse)};a.UnspecifiedEntity=function(){a.UnspecifiedEntity.superClazz.apply(this,arguments);var b=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,b,d(this));var h=this._privates(c);g.call(this)},a.UnspecifiedEntity.prototype={identifier:function(){return c},_minWidth:70,_minHeight:50},a.util.setSuperClass(a.UnspecifiedEntity,a.Labelable)}(bui),function(a){var c="bui.EmptySet",d=function(a){return c+a.id()},e=function(a,b){var d=b/2,e=this._privates(c);e.circle.setAttributeNS(null,"cx",d),e.circle.setAttributeNS(null,"cy",d),e.circle.setAttributeNS(null,"r",d);var f=["M",0,b,"L",b,0,"Z"].join(" ");e.dash.setAttributeNS(null,"d",f),e.dash.setAttributeNS(null,"stroke","black"),e.dash.setAttributeNS(null,"stroke-width",2)},f=function(){var a=this._privates(c),b=this.color();a.circle.style.setProperty("fill",b.background),a.circle.style.setProperty("stroke",b.border)},h=function(){var d=this.nodeGroup(),g=this._privates(c);g.circle=b.createElementNS(a.svgns,"circle"),g.dash=b.createElementNS(a.svgns,"path"),e.call(this,this,this.size().width),f.call(this,this,this.color()),d.appendChild(g.circle),d.appendChild(g.dash)};a.EmptySet=function(){a.EmptySet.superClazz.apply(this,arguments);var b=f.createDelegate(this);this.bind(a.Node.ListenerType.size,e.createDelegate(this),d(this)),this.bind(a.Labelable.ListenerType.color,b,d(this)),h.call(this)},a.EmptySet.prototype={identifier:function(){return c},_minWidth:60,_minHeight:60,_forceRectangular:!0,_calculationHook:g},a.util.setSuperClass(a.EmptySet,a.Labelable)}(bui),function(a){var b="bui.Process";a.Process=function(b){a.Process.superClazz.apply(this,arguments),this.labelClass(a.settings.css.classes.smallText,[a.settings.css.classes.textDimensionCalculation.small]),this.addClass(a.settings.css.classes.process),typeof b=="object"&&(b==379?this.label("\\\\"):b==396&&this.label("?"))},a.Process.prototype={identifier:function(){return b},_enableResizing:!1,_adaptSizeToLabel:!1,_minWidth:a.settings.style.processNodeMinSize.width,_minHeight:a.settings.style.processNodeMinSize.height,_ignLabelSize:!0},a.util.setSuperClass(a.Process,a.RectangularNode)}(bui),function(a){var b="bui.AttachedDrawable",c=function(a){return b+a.id()},d=function(){this.source(null)},e=function(){this.target(null)},f=function(b,e,f){e!==null&&e.bind(a.Drawable.ListenerType.remove,d.createDelegate(this),c(this)),f!==null&&f.unbindAll(c(this))},g=function(b,d,f){d!==null&&d.bind(a.Drawable.ListenerType.remove,e.createDelegate(this),c(this)),f!==null&&f.unbindAll(c(this))},h=function(){var a=this._privates(b);a.source!==null&&a.source.unbindAll(c(this)),a.target!==null&&a.target.unbindAll(c(this))};a.AttachedDrawable=function(){a.AttachedDrawable.superClazz.apply(this,arguments),this._addType(a.AttachedDrawable.ListenerType),this.bind(a.AttachedDrawable.ListenerType.source,f.createDelegate(this),c(this)),this.bind(a.AttachedDrawable.ListenerType.target,g.createDelegate(this),c(this)),this.bind(a.Drawable.ListenerType.remove,h.createDelegate(this),c(this));var d=this._privates(b);d.source=null,d.target=null},a.AttachedDrawable.prototype={source:function(c){var d=this._privates(b);if(c!==undefined){if(c!==d.source){var e=d.source;d.source=c,this.fire(a.AttachedDrawable.ListenerType.source,[this,d.source,e])}return this}return d.source},target:function(c){var d=this._privates(b);if(c!==undefined){if(c!==d.target){var e=d.target;d.target=c,this.fire(a.AttachedDrawable.ListenerType.target,[this,d.target,e])}return this}return d.target},toJSON:function(){var c=a.AttachedDrawable.superClazz.prototype.toJSON.call(this),d=a.settings.dataFormat,e=this._privates(b);return e.source!==null&&(e.source.identifier()=="bui.EdgeHandle"?k(c,d.edge.source,e.source.lparent.id()):e.source.identifier()=="bui.StateVariableER"||e.source.identifier()=="bui.StateVariable"?k(c,d.edge.source,e.source.parent().id()+":"+e.source.toJSON()):k(c,d.edge.source,e.source.id())),e.target!==null&&(e.target.identifier()=="bui.EdgeHandle"?k(c,d.edge.target,e.target.lparent.id()):e.target.identifier()=="bui.StateVariableER"||e.target.identifier()=="bui.StateVariable"?k(c,d.edge.target,e.target.parent().id()+":"+e.target.toJSON()):k(c,d.edge.target,e.target.id())),c}},a.util.setSuperClass(a.AttachedDrawable,a.Drawable),a.AttachedDrawable.ListenerType={source:a.util.createListenerTypeId(),target:a.util.createListenerTypeId()}}(bui),function(a){var b="bui.AbstractLine",c=function(a){return b+a.id()},d=function(b,c){c===!0?this.removeClass(a.settings.css.classes.invisible):this.addClass(a.settings.css.classes.invisible)},e=function(a,b){this._line.setAttributeNS(null,"class",b)},f=function(){this._line.parentNode.removeChild(this._line)},g=function(){var a=this.source(),b=this.target();this.visible(a!==null&&b!==null&&a.visible()===!0&&b.visible()===!0)},h=function(b,d,e){e!==null&&e.unbindAll(c(this));if(d!==null){var f=this._sourceOrTargetDimensionChanged.createDelegate(this);d.bind(a.Node.ListenerType.absolutePosition,f,c(this)),d.bind(a.Node.ListenerType.size,f,c(this)),d.bind(a.Drawable.ListenerType.visible,g.createDelegate(this),c(this))}this._sourceOrTargetDimensionChanged(),g.call(this)},i=function(b,d,e){e!==null&&e.unbindAll(c(this));if(d!==null){var f=this._sourceOrTargetDimensionChanged.createDelegate(this);d.bind(a.Node.ListenerType.absolutePosition,f,c(this)),d.bind(a.Node.ListenerType.size,f,c(this)),d.bind(a.Drawable.ListenerType.visible,g.createDelegate(this),c(this))}this._sourceOrTargetDimensionChanged(),g.call(this)},j=function(b){this.hoverEffectActive(!0),this.fire(a.AbstractLine.ListenerType.mouseEnter,[this,b])},l=function(b){this.hoverEffectActive(!1),this.fire(a.AbstractLine.ListenerType.mouseLeave,[this,b])},m=function(c,d){var e;d===!0&&this.hoverEffect()?(this.addClass(a.settings.css.classes.lineHover),e=this._privates(b).marker,e!==null&&this._line.setAttributeNS(null,"marker-end",a.util.createMarkerAttributeValue(a.util.getHoverId(e)))):(this.removeClass(a.settings.css.classes.lineHover),e=this._privates(b).marker,e!==null&&this._line.setAttributeNS(null,"marker-end",a.util.createMarkerAttributeValue(e)))},n=function(b){this.fire(a.AbstractLine.ListenerType.click,[this,b])},o=function(b){this.fire(a.AbstractLine.ListenerType.mousedown,[this,b])};a.AbstractLine=function(g){a.AbstractLine.superClazz.call(this,g),this._addType(a.AbstractLine.ListenerType);var k=this._privates(b);k.hoverEffect=!0,k.marker=null,k.markerId=null,k.hoverEffectActive=!1,k.lineStyle=null,this.bind(a.Drawable.ListenerType.visible,d.createDelegate(this),c(this)),this.bind(a.Drawable.ListenerType.classes,e.createDelegate(this),c(this)),this.bind(a.Drawable.ListenerType.remove,f.createDelegate(this),c(this)),this.bind(a.AttachedDrawable.ListenerType.source,h.createDelegate(this),c(this)),this.bind(a.AttachedDrawable.ListenerType.target,i.createDelegate(this),c(this)),this.bind(a.AbstractLine.ListenerType.marker,this._markerChanged.createDelegate(this),c(this)),this.bind(a.AbstractLine.ListenerType.hoverEffectActive,m.createDelegate(this),c(this)),this._initialPaint(),this._line.setAttributeNS(null,"id",this.id()),jQuery(this._line).mouseenter(j.createDelegate(this)),jQuery(this._line).mouseleave(l.createDelegate(this)),jQuery(this._line).click(n.createDelegate(this)),jQuery(this._line).mousedown(o.createDelegate(this)),this.addClass(a.settings.css.classes.line)},a.AbstractLine.prototype={_line:null,_initialPaint:function(){throw"Not implemented!"},_sourceOrTargetDimensionChanged:function(){throw"Not implemented!"},_markerChanged:function(b,c){c===null?(this._line.setAttributeNS(null,"marker-end",""),this._line.removeAttributeNS(null,"marker-end")):this._line.setAttributeNS(null,"marker-end",a.util.createMarkerAttributeValue(c))},marker:function(c){var d=this._privates(b);if(c!==undefined){if(c===null)d.marker=null,d.markerId=null,this.fire(a.AbstractLine.ListenerType.marker,[this,null]);else{var e=this.graph().connectingArcs()[c];e!==undefined&&e.id!==d.marker&&(d.marker=e.id,d.markerId=c,this.fire(a.AbstractLine.ListenerType.marker,[this,e.id]))}return this}return d.marker},lineStyle:function(c){for(var d in a.AbstractLine.Style)a.AbstractLine.Style.hasOwnProperty(d)&&this.removeClass(a.AbstractLine.Style[d]);return this._privates(b).lineStyle=c,this.addClass(a.AbstractLine.Style[c]),this},hoverEffect:function(a){var c=this._privates(b);return a!==undefined?(c.hoverEffect=a,this):c.hoverEffect},hoverEffectActive:function(c){var d=this._privates(b);return c!==undefined?(c=c&&this.hoverEffect(),c!==d.hoverEffectActive&&(d.hoverEffectActive=c,this.fire(a.AbstractLine.ListenerType.hoverEffectActive,[this,c])),this):d.hoverEffectActive},toJSON:function(){var c=a.AbstractLine.superClazz.prototype.toJSON.call(this),d=a.settings.dataFormat,e=this._privates(b);e.lineStyle!==null&&e.lineStyle!==a.AbstractLine.Style.solid&&k(c,d.edge.style,e.lineStyle);if(e.markerId!==null){var f=v(e.markerId);f!==null&&k(c,d.drawable.sbo,f)}return c}},a.util.setSuperClass(a.AbstractLine,a.AttachedDrawable),a.AbstractLine.ListenerType={marker:a.util.createListenerTypeId(),click:a.util.createListenerTypeId(),mousedown:a.util.createListenerTypeId(),mouseEnter:a.util.createListenerTypeId(),mouseLeave:a.util.createListenerTypeId(),hoverEffectActive:a.util.createListenerTypeId()},a.AbstractLine.Style={solid:a.settings.css.classes.lineStyle.solid,dotted:a.settings.css.classes.lineStyle.dotted,dashed:a.settings.css.classes.lineStyle.dashed}}(bui),function(a){var c="bui.StraightLine",d=function(a){return c+a.id()};a.StraightLine=function(b){a.StraightLine.superClazz.apply(this,arguments)},a.StraightLine.prototype={includeInJSON:!1,_initialPaint:function(){var d=this._privates(c);this._line=b.createElementNS(a.svgns,"line"),this.graph().edgeGroup().appendChild(this._line),this.addClass(a.settings.css.classes.invisible)},_sourceOrTargetDimensionChanged:function(){var a=this.target(),b=this.source();if(a!==null&&b!==null){var c=b.calculateLineEnd(a);this._line.setAttributeNS(null,"x1",c.x),this._line.setAttributeNS(null,"y1",c.y),c=a.calculateLineEnd(b),this._line.setAttributeNS(null,"x2",c.x),this._line.setAttributeNS(null,"y2",c.y)}}},a.util.setSuperClass(a.StraightLine,a.AbstractLine)}(bui),function(a){var c="bui.Spline",d=function(a){return c+a.id()},e=function(a,b){var d=this._privates(c);d.sourceHelperLine.target(b)},f=function(a,b){var d=this._privates(c);d.targetHelperLine.target(b)},g=function(a,b){b===!1&&this.layoutElementsVisible(!1)},h=function(a){a.ctrlKey===!0&&this.layoutElementsVisible(!this.layoutElementsVisible())};a.Spline=function(b){a.Spline.superClazz.apply(this,arguments),this.bind(a.AttachedDrawable.ListenerType.source,e.createDelegate(this),d(this)),this.bind(a.AttachedDrawable.ListenerType.target,f.createDelegate(this),d(this)),this.bind(a.Drawable.ListenerType.visible,g.createDelegate(this),d(this))},a.Spline.prototype={_initialPaint:function(){var e=this._privates(c);e.layoutElementsVisible=!0,e.points=[],e.sourceSplineHandlePos={x:0,y:0},e.targetSplineHandlePos={x:0,y:0},this._line=b.createElementNS(a.svgns,"path"),this.graph().edgeGroup().appendChild(this._line),this.addClass(a.settings.css.classes.invisible);var f=this._splineHandleChanged.createDelegate(this);e.sourceSplineHandle=this.graph().add(a.SplineEdgeHandle).bind(a.Node.ListenerType.absolutePosition,f,d(this)).visible(e.layoutElementsVisible),e.targetSplineHandle=this.graph().add(a.SplineEdgeHandle).bind(a.Node.ListenerType.absolutePosition,f,d(this)).visible(e.layoutElementsVisible),e.sourceHelperLine=this.graph().add(a.StraightLine).lineStyle(a.AbstractLine.Style.dotted).hoverEffect(!1).source(e.sourceSplineHandle).visible(e.layoutElementsVisible),e.targetHelperLine=this.graph().add(a.StraightLine).lineStyle(a.AbstractLine.Style.dotted).hoverEffect(!1).source(e.targetSplineHandle).visible(e.layoutElementsVisible),jQuery(this._line).click(h.createDelegate(this))},_splineHandleChanged:function(){var a=this._privates(c);if(a.positioningSplineHandles)return;a.sourceSplineHandlePos.x=a.sourceSplineHandle.absoluteCenter().x-this.source().absoluteCenter().x,a.sourceSplineHandlePos.y=a.sourceSplineHandle.absoluteCenter().y-this.source().absoluteCenter().y;for(var b=0;b<a.points.length;b++)a.points[b].x=a.points[b].splineHandle.absoluteCenter().x-a.points[b].point.absoluteCenter().x,a.points[b].y=a.points[b].splineHandle.absoluteCenter().y-a.points[b].point.absoluteCenter().y;a.targetSplineHandlePos.x=a.targetSplineHandle.absoluteCenter().x-this.target().absoluteCenter().x,a.targetSplineHandlePos.y=a.targetSplineHandle.absoluteCenter().y-this.target().absoluteCenter().y,this._sourceOrTargetDimensionChanged()},_sourceOrTargetDimensionChanged:function(){var a=this.target(),b=this.source();if(a!==null&&b!==null){var d=this._privates(c);d.positioningSplineHandles=!0,d.sourceSplineHandle.absolutePositionCenter(b.absoluteCenter().x+d.sourceSplineHandlePos.x,b.absoluteCenter().y+d.sourceSplineHandlePos.y);for(var e=0;e<d.points.length;e++)d.points[e].splineHandle.absolutePositionCenter(d.points[e].point.absoluteCenter().x+d.points[e].x,d.points[e].point.absoluteCenter().y+d.points[e].y);d.targetSplineHandle.absolutePositionCenter(a.absoluteCenter().x+d.targetSplineHandlePos.x,a.absoluteCenter().y+d.targetSplineHandlePos.y);var f=d.sourceSplineHandle,g=d.targetSplineHandle,h=b.calculateLineEnd(f),i=a.calculateLineEnd(g),j=h.x-b.absoluteCenter().x,k=h.y-b.absoluteCenter().y;Math.abs(j)>=Math.abs(d.sourceSplineHandlePos.x)&&(d.sourceSplineHandlePos.x=j*1.2,d.sourceSplineHandlePos.y=k*1.2,d.sourceSplineHandle.absolutePositionCenter(b.absoluteCenter().x+d.sourceSplineHandlePos.x,b.absoluteCenter().y+d.sourceSplineHandlePos.y)),j=i.x-a.absoluteCenter().x,k=i.y-a.absoluteCenter().y,Math.abs(j)>=Math.abs(d.targetSplineHandlePos.x)&&(d.targetSplineHandlePos.x=j*1.2,d.targetSplineHandlePos.y=k*1.2,d.targetSplineHandle.absolutePositionCenter(a.absoluteCenter().x+d.targetSplineHandlePos.x,a.absoluteCenter().y+d.targetSplineHandlePos.y)),d.positioningSplineHandles=!1;var l=f.absoluteCenter(),m=g.absoluteCenter(),n=["M",h.x,h.y,"C",l.x,l.y];for(var e=0;e<d.points.length;e++){var o=d.points[e];n.push.apply(n,[o.point.absoluteCenter().x+o.x,o.point.absoluteCenter().y+o.y,o.point.absoluteCenter().x,o.point.absoluteCenter().y,"S"])}n.push.apply(n,[m.x,m.y,i.x,i.y]),this._line.setAttributeNS(null,"d",n.join(" "))}},layoutElementsVisible:function(a){var b=this._privates(c);if(a!==undefined){b.layoutElementsVisible=a,b.sourceSplineHandle.visible(a),b.targetSplineHandle.visible(a);for(var d=0;d<b.points.length;d++)b.points[d].splineHandle.visible(a),b.points[d].helperLine.visible(a),b.points[d].point.visible(a);return b.sourceHelperLine.visible(a),b.targetHelperLine.visible(a),this}return b.layoutElementsVisible},setSplinePoints:function(b,e){var f=this._privates(c),g=b.length/2-f.points.length;if(g<0)for(var h=f.points.length-g;h<f.points.length;h++)delete f.points[h].splineHandle,delete f.points[h].helperLine,delete f.points[h].point;if(g>0){var i=this._sourceOrTargetDimensionChanged.createDelegate(this),j=this._splineHandleChanged.createDelegate(this);for(var h=f.points.length;h<b.length/2;h++)f.points[h]={x:0,y:0},f.points[h].splineHandle=this.graph().add(a.SplineEdgeHandle).bind(a.Node.ListenerType.absolutePosition,j,d(this)).visible(f.layoutElementsVisible),f.points[h].point=this.graph().add(a.EdgeHandle).bind(a.Node.ListenerType.absolutePosition,i,d(this)).visible(f.layoutElementsVisible),f.points[h].helperLine=this.graph().add(a.StraightLine).lineStyle(a.AbstractLine.Style.dotted).hoverEffect(!1).source(f.points[h].splineHandle).target(f.points[h].point).visible(f.layoutElementsVisible)}for(var h=0;h<b.length;h+=2){var k=h/2;f.points[k].point.moveAbsoluteCenter(a.util.toNumber(b[h]),a.util.toNumber(b[h+1]),e)}},setSplineHandlePositions:function(b,d){var e=this._privates(c),f=this.target(),g=this.source();e.sourceSplineHandlePos.x=a.util.toNumber(b[0]),e.sourceSplineHandlePos.y=a.util.toNumber(b[1]);for(var h=2;h<b.length-2;h+=2){var i=(h-2)/2;if(e.points[i])e.points[i].x=a.util.toNumber(b[h]),e.points[i].y=a.util.toNumber(b[h+1]);else throw"not enough spline points set for spline handles"}return e.targetSplineHandlePos.x=a.util.toNumber(b[h]),e.targetSplineHandlePos.y=a.util.toNumber(b[h+1]),this._sourceOrTargetDimensionChanged(),this},toJSON:function(){var b=a.Spline.superClazz.prototype.toJSON.call(this),d=a.settings.dataFormat,e=this._privates(c),f=[e.sourceSplineHandlePos.x,e.sourceSplineHandlePos.y],g=[];for(var h=0;h<e.points.length;h++){var i=e.points[h].point.absoluteCenter();g.push.apply(g,[i.x,i.y]),f.push.apply(f,[e.points[h].x,e.points[h].y])}return f.push.apply(f,[e.targetSplineHandlePos.x,e.targetSplineHandlePos.y]),k(b,d.edge.handles,f),k(b,d.edge.points,g),b}},a.util.setSuperClass(a.Spline,a.AbstractLine)}(bui),function(a){var b="bui.Edge",c=function(a){return b+a.id()},d=function(){var a=this.source(),b=this.target();this.visible(a!==null&&a.visible()===!0&&b!==null&&b.visible()===!0)},e=function(e,f,g){var h=this._privates(b);h.lines[0].source(f),g!==null&&g.unbindAll(c(this)),f!==null&&(f.bind(a.Drawable.ListenerType.visible,d.createDelegate(this),c(this)),f.bind(a.Node.ListenerType.absolutePosition,p.createDelegate(this),c(this)))},f=function(e,f,g){var h=this._privates(b);h.lines[h.lines.length-1].target(f),g!==null&&g.unbindAll(c(this)),f!==null&&(f.bind(a.Drawable.ListenerType.visible,d.createDelegate(this),c(this)),f.bind(a.Node.ListenerType.absolutePosition,p.createDelegate(this),c(this)))},g=function(){var a=this._privates(b),c=this.visible()===!0&&a.edgeHandlesVisible===!0,d=a.handles;for(var e=0;e<d.length;e++){var f=d[e].size();f.width==1?d[e].hasClass("Outcome")||d[e].size(12,12):d[e].hasClass("Outcome")||d[e].size(1,1)}var g=a.lines;for(var e=0;e<g.length;e++)g[e].visible(!0)},h=function(a,c){var d=this._privates(b),e=d.lines;for(var f=0;f<e.length;f++)e[f].visible(c);g.call(this)},i=function(){var d=this.graph().suspendRedraw(200),e=this._privates(b),f=e.lines;for(var g=0;g<f.length;g++)f[g].remove();var h=e.handles,i=this.graph(),j=m.createDelegate(this),k=l.createDelegate(this),p=n.createDelegate(this),q=o.createDelegate(this),r=c(this),s=this.source(),t=null,u=e.lineStyle;f=[];var v=function(){var b=i.add(a.StraightLine).source(s).target(t).lineStyle(u).bind(a.AbstractLine.ListenerType.mouseEnter,p,r).bind(a.AbstractLine.ListenerType.mouseLeave,q,r);a.settings.enableModificationSupport===!0&&b.bind(a.AbstractLine.ListenerType.click,j,r).bind(a.AbstractLine.ListenerType.mousedown,k,r),f.push(b),s=t};for(g=0;g<h.length;g++)t=h[g],v();t=this.target(),v(),e.lines=f,e.marker!==null&&f[f.length-1].marker(e.marker),this.graph().unsuspendRedraw(d)},j=function(c,d,e){var f=this._privates(b),g=this.graph().add(a.EdgeHandle).visible(f.edgeHandlesVisible);g.positionCenter(d,e);var h=f.handles.indexOf(c);return h===-1?h=0:h++,f.handles.splice(h,0,g),i.call(this),g},l=function(a,b){if(b.ctrlKey!==!0){var c=1/this.graph().scale(),d=this.graph(),e=d.translate(),f=d.htmlTopLeft();j.call(this,a.source(),(b.pageX-f.x)*c-e.x,(b.pageY-f.y)*c-e.y).startDragging(b.pageX,b.pageY)}},m=function(a,b){b.ctrlKey===!0&&this.edgeHandlesVisible(!this.edgeHandlesVisible())},n=function(){var a=this._privates(b),c=a.lines;for(var d=0;d<c.length;d++)c[d].hoverEffectActive(!0)},o=function(){var a=this._privates(b),c=a.lines;for(var d=0;d<c.length;d++)c[d].hoverEffectActive(!1)},p=function(){if(a.settings.straightenEdges){var c=this._privates(b);if(c.handles.length>0&&c.lines[0].source()!=null&&c.lines[c.lines.length-1].target()!=null){var d=c.lines[0].source().absoluteCenter(),e=c.lines[c.lines.length-1].target().absoluteCenter(),f=1/(c.handles.length+3),g=e.x-d.x,h=e.y-d.y;for(var j=0;j<c.handles.length;j++)c.handles[j].positionCenter(d.x+(j+2)*f*g,d.y+(j+2)*f*h);i.call(this)}}};a.Edge=function(){a.Edge.superClazz.apply(this,arguments);var d=this._privates(b);d.edgeHandlesVisible=!0,d.handles=[],d.lines=[],d.marker=null,d.lineStyle=null,i.call(this),this.bind(a.AttachedDrawable.ListenerType.source,e.createDelegate(this),c(this)),this.bind(a.AttachedDrawable.ListenerType.target,f.createDelegate(this),c(this)),this.bind(a.Drawable.ListenerType.visible,h.createDelegate(this),c(this))},a.Edge.prototype={identifier:function(){return b},addPoint:function(c,d,e){var f=this._privates(b),g=undefined;return e=="Outcome"?(g=this.graph().add(a.EdgeHandle).size(12,12).visible(!0),g.addClass("Outcome")):e=="and"||e=="or"||e=="not"||e=="delay"?(g=this.graph().add(a.LogicalOperator,e).visible(!0),g.addClass("LogicalOperator")):(g=this.graph().add(a.EdgeHandle).visible(!0),g.addClass("edgeHandle")),g.lparent=this,g.positionCenter(c,d),index=0,f.handles.splice(index,0,g),i.call(this),g},recalculatePoints:function(){p.call(this)},handles:function(){var a=this._privates(b);return a.handles},edgeHandlesVisible:function(a){var c=this._privates(b);return a!==undefined?(c.edgeHandlesVisible=a,g.call(this),this):c.edgeHandlesVisible},marker:function(a){var c=this._privates(b);return a!==undefined?(a===null?c.marker=null:c.marker=a,i.call(this),this):c.marker},lineStyle:function(a){var c=this._privates(b);return c.lineStyle=a,i.call(this),this},toJSON:function(){var c=a.Edge.superClazz.prototype.toJSON.call(this),d=a.settings.dataFormat,e=this._privates(b);e.lineStyle!==null&&e.lineStyle!==a.AbstractLine.Style.solid&&k(c,d.edge.style,e.lineStyle);if(e.handles.length>0){var f=[];for(var g=0;g<e.handles.length;g++){var h=e.handles[g].absoluteCenter();f.push(h)}k(c,d.edge.handles,f)}if(e.marker!==null){var i=v(e.marker);i!==null&&k(c,d.drawable.sbo,i)}return c}},a.util.setSuperClass(a.Edge,a.AttachedDrawable)}(bui),l(m,[285],bui.UnspecifiedEntity),l(m,[247,240,245],bui.SimpleChemical),l(m,[245,252],bui.Macromolecule),l(m,[250,251],bui.NucleicAcidFeature),l(m,[405,347],bui.Perturbation),l(m,[358],bui.Phenotype),l(m,[253],bui.Complex),l(m,[290],bui.Compartment),l(m,[375,167,379,396],bui.Process),l(m,[-1],bui.Helper),l(m,[110001],bui.VariableValue),l(m,[110002,110004],bui.Tag),l(m,[395,412,110003],bui.RectangularNode),l(m,[177,409],bui.Association),l(m,[180],bui.Dissociation),l(m,[174,173,238,225],bui.LogicalOperator),l(m,[291],bui.EmptySet),l(m,[110005],bui.EdgeHandle),l(n,[375,167],bui.Process),l(o,[19,168],bui.connectingArcs.control.id),l(o,[20,169],bui.connectingArcs.inhibition.id),l(o,[407],bui.connectingArcs.absoluteInhibition.id),l(o,[464,342],bui.connectingArcs.assignment.id),l(o,[459,462,170],bui.connectingArcs.stimulation.id),l(o,[15,394],bui.connectingArcs.substrate.id),l(o,[11,393],bui.connectingArcs.production.id),l(o,[461],bui.connectingArcs.necessaryStimulation.id),l(o,[13],bui.connectingArcs.catalysis.id),l(o,[411],bui.connectingArcs.absoluteStimulation.id),r([111100],"unknownModification","?"),r([111101],"active","active"),r([111102],"inactive","inactive"),r([215],"acetylation","A"),r([217],"glycosylation","G"),r([233],"hydroxylation","OH"),r([214],"methylation","M"),r([219],"myristoylation","MYR"),r([218],"palmitoylation","PAL"),r([216],"phosphorylation","P"),r([224],"ubiquitination","U"),function(a){var b=function(b,c,d){var e;d.sbo==174||d.sbo==173||d.sbo==238||d.sbo==225||d.sbo==396||d.sbo==379?e=b.add(c.klass,d.id,[d.sbo]):e=b.add(c.klass,d.id),a.util.propertySetAndNotNull(d,["data","label"])&&e.label!==undefined&&e.label(d.data.label),a.util.propertySetAndNotNull(d,["data","orientation"])&&e.identifier()=="bui.Tag"&&e.orientation(d.data.orientation),d.data=d.data||{},a.util.propertySetAndNotNull(d,["data","x"],["data","y"])&&(d.data.x=a.util.toNumber(d.data.x),d.data.y=a.util.toNumber(d.data.y),e.position(d.data.x,d.data.y));var f=a.settings.style.importer.standardNodeSize,g={width:f.width,height:f.height};if(a.util.propertySetAndNotNull(d,["data","width"],["data","height"]))g.width=d.data.width,g.height=d.data.height;else if(e.sizeBasedOnLabel!==undefined&&!e._ignLabelSize){g=e.sizeBasedOnLabel();var h=a.settings.style.importer.sizeBasedOnLabelPassing;g.width+=h.horizontal,g.height+=h.vertical}if(a.util.propertySetAndNotNull(d,["data","cssClasses"])&&a.util.propertySetAndNotNull(d,["data","cssClasses"]))if(d.data.cssClasses instanceof Array)for(var i=0;i<d.data.cssClasses.length;i++)e.addClass(d.data.cssClasses[i]);else j("Converted cssClasses "+d.data.cssClasses+" to String"),e.addClass(d.data.cssClasses);"clone_marker"in d.data&&d.data.clone_marker==1&&e.addClass("cloneMarker"),e.size(g.width,g.height).visible(!0),d.data.width=g.width,d.data.height=g.height;if(d.data.unitofinformation!==undefined)for(var i=0;i<d.data.unitofinformation.length;i++)uoi=b.add(a.UnitOfInformation).label(d.data.unitofinformation[i]).parent(e).visible(!0).json(d.data.unitofinformation[i]);if(a.util.propertySetAndNotNull(d,["data","statevariable"])){var k=d.data.statevariable,l=a.StateVariable;a.settings.SBGNlang=="ER"&&(l=a.StateVariableER);for(var i=0;i<k.length;i++)statevar=b.add(l).label(k[i]).parent(e).visible(!0).json(k[i]),a.settings.SBGNlang=="ER"&&(statevar.size(60,14),k[i]=="existence"&&statevar.label("").addClass("existence").size(14,14),k[i]=="location"&&statevar.label("").addClass("location").size(14,14))}if(a.util.propertySetAndNotNull(d,["data","modification"])){var m=d.data.modification;for(var i=0;i<m.length;i++){var n=m[i],o,q=s(p,n[0]);o=q.short,a.settings.style.importer.modificationLabel==="long"&&(o+="@"+n[1]),b.add(a.StateVariable).label(o).parent(e).visible(!0).json(n)}}return e},c=function(c,d){var e=d.nodes,f={},g,h,i=function(d,e){var g=s(m,d.sbo),h;return g===undefined?undefined:(a.util.propertySetAndNotNull(g,"generator")?h=g.generator(c,d):h=b(c,g,d),h!==undefined&&(h.json(d),f[e]=h),h)};for(var k=0;k<e.length;k++)try{h=e[k],i(h,h.id)}catch(l){j(l)}for(var n in f)if(f.hasOwnProperty(n)){g=f[n],h=g.json();if(h.data!==undefined&&h.data.subnodes!==undefined)for(var o=0;o<h.data.subnodes.length;o++){var p=h.data.subnodes[o],q=f[p];q!==undefined?q.parent(g):j("Warning: Broken sub node reference to sub node id: "+p)}}return f},d=function(b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];if(d instanceof a.Complex&&d.parent()instanceof a.Complex==0){d.tableLayout();var e=d.size(),f=d.json();f.data.width=e.width,f.data.height=e.height}}},e=function(a){for(var b in a)a.hasOwnProperty(b)&&a[b].positionAuxiliaryUnits()},f=function(b,c,d){var e=c.edges,f=[],g=b.drawables(),h={};for(var i=0;i<e.length;i++){var k=e[i],l;if(k.source===undefined||k.target===undefined)continue;var m=undefined;if(k.source.indexOf(":")!=-1){node_ids=k.source.split(":"),m=d[node_ids[0]];if(m!==undefined){q=m.children();for(var n=0;n<q.length;n++)if(q[n].label()==node_ids[1]||q[n].hasClass(node_ids[1])){m=g[q[n].id()];break}}}else var m=d[k.source];var p=undefined;if(k.target.indexOf(":")!=-1){node_ids=k.target.split(":"),p=d[node_ids[0]];if(p!==undefined){var q=p.children();for(var n=0;n<q.length;n++)if(q[n].label()==node_ids[1]||q[n].hasClass(node_ids[1])){p=g[q[n].id()];break}}}else p=d[k.target];if(m===undefined||p===undefined){f.push(k);continue}k.data=k.data||{};if(k.data.handles!==undefined&&k.data.handles.length>=4)l=b.add(a.Spline,k.id).layoutElementsVisible(!1),l.json(k).source(m).target(p),k.data.points!==undefined&&l.setSplinePoints(k.data.points),k.data.handles!==undefined&&l.setSplineHandlePositions(k.data.handles);else{l=b.add(a.Edge,k.id),l.json(k).source(m).target(p);if(k.data.points!==undefined)for(var n=0;n<k.data.points.length;n+=2)l.addPoint(k.data.points[n],k.data.points[n+1]);if(k.data.handles!==undefined)for(var r=0;r<k.data.handles.length;++r){var t=k.data.handles[r];l.addPoint(t.x,t.y)}}if(k.sbo!==undefined)if(k.source.split(":")[0]==k.target.split(":")[0]&&k.sbo==342){var t=l.source().absoluteCenter(),u=l.source().size(),v="cis_trans";k.data.cis_trans!==undefined&&(v=k.data.cis_trans);var w=b.add(a.RectangularNode).visible(!0).size(50,20).label(v);w.positionCenter(t.x+u.width+30,t.y),l.json(k).source(w).target(p),back_edge=b.add(a.Edge,k.id+"_back"),back_edge.json(k).source(w).target(m);var x=s(o,k.sbo);back_edge.marker(x.klass),l.marker(x.klass),back_edge.addPoint(t.x+u.width+30,t.y-20),l.addPoint(t.x+u.width+30,t.y+20)}else try{var x=s(o,k.sbo);l.marker(x.klass)}catch(y){j(y)}var z=a.AbstractLine.Style[k.data.style];z!==undefined&&l.lineStyle(z),l.visible(!0),h[k.id]=l}var A=f.length+1;while(f.length>0&&f.length<A){A=f.length;for(var i=0;i<f.length;i++){var B=undefined,C=undefined,k=f[i],p=undefined;if(k.target.indexOf(":")!=-1){node_ids=k.target.split(":"),p=d[node_ids[0]];if(p!==undefined){var q=p.children();for(var n=0;n<q.length;n++)if(q[n].label()==node_ids[1]||q[n].hasClass(node_ids[1])){p=g[q[n].id()];break}}}else p=d[k.target];if(p===undefined){C=h[k.target];if(C===undefined)continue;p=C.addPoint(0,0)}var m=undefined;if(k.source.indexOf(":")!=-1){node_ids=k.source.split(":"),m=d[node_ids[0]];if(m!==undefined){q=m.children();for(var n=0;n<q.length;n++)if(q[n].label()==node_ids[1]||q[n].hasClass(node_ids[1])){m=g[q[n].id()];break}}}else m=d[k.source];if(m===undefined){B=h[k.source];if(B===undefined)continue;m=B.addPoint(0,0,"Outcome")}if(m===undefined||p===undefined)continue;rm_elem=f.splice(i,1),l=b.add(a.Edge,k.id),l.source(m).target(p);var x=s(o,k.sbo);l.marker(x.klass);if(k.data.handles!==undefined)for(var r=0;r<k.data.handles.length;++r){var t=k.data.handles[r];l.addPoint(t.x,t.y)}h[k.id]=l}}for(edge_id in h){var l=h[edge_id];if(l.identifier()=="bui.Edge"){var D=l.handles();for(var i=0;i<D.length;i++){var E=D[i].positionCenter();if(E.x==0&&E.y==0){l.recalculatePoints();break}}}}for(var i=0;i<f.length;i++){var F=!0;d[f[i].source]===undefined&&h[f[i].source]===undefined&&(j("Edge source "+f[i].source+" could not be found. Edge ID: "+f[i].id),F=!1),d[f[i].target]===undefined&&h[f[i].target]===undefined&&(j("Edge target "+f[i].target+" could not be found. Edge ID: "+f[i].id),F=!1),F&&j("found but not added: "+JSON.stringify(f[i]))}j("Edge stack still contains "+String(f.length)+" edges")},g=function(b){var c,d,e=function(b){var c=b.childrenWithoutAuxiliaryUnits(),d;b instanceof a.Compartment||b.toFront();for(d=0;d<c.length;d++){var f=c[d];e(f)}var g=b.auxiliaryUnits();for(d=0;d<g.length;d++)g[d].toFront()};for(c in b)b.hasOwnProperty(c)&&(d=b[c],d.hasParent()===!1&&d instanceof a.Compartment&&e(d));for(c in b)b.hasOwnProperty(c)&&(d=b[c],d.hasParent()===!1&&!(d instanceof a.Compartment)&&e(d))};a.importFromJSON=function(b,h){var i=(new Date).getTime(),k=b.suspendRedraw(2e4);"sbgnlang"in h&&(a.settings.SBGNlang=h.sbgnlang),j("## Setting SBGN language to "+a.settings.SBGNlang),j("## Importing all nodes");var l=c(b,h);j("## Layout complexes"),d(l),j("## Layout auxiliary units"),e(l),j("## Aligning nodes according to parent-child relationships"),g(l),j("## Adding all edges"),f(b,h,l),j("## Reducing canvas size"),b.reduceCanvasSize(),b.unsuspendRedraw(k);var m=(new Date).getTime()-i;j("## Complete import took "+m+"ms.");for(var n in l)if(l.hasOwnProperty(n)){var o=l[n],p=o.position(),q=o.parent();if("identifier"in q&&q.identifier()=="Compartment"){var r=q.position();o.position(p.x-r.x,p.y-r.y),console.log("reset pos")}}},a.importUpdatedNodePositionsFromJSON=function(b,c,d,e){var f=b.drawables(),g={};for(var h in f)if(f.hasOwnProperty(h)){var i=f[h],k=i.json();k!==undefined&&k!==null&&(g[k.id]=i)}var l=c.nodes,m,n=!1;for(m=0;m<l.length;m++){var o=l[m],p=g[o.id];if(p===undefined){j("Warning: Can't update nodes position for json node id "+o.id+" because the node can't be found.");continue}if(a.util.propertySetAndNotNull(o,["data","x"],["data","y"])===!1)continue;if(!(p.hasParent()!==!0||p.parent()instanceof a.Compartment))continue;if(p instanceof a.Compartment){var q=o.data.width,r=o.data.height;q&&r&&p.resize(q,r,d)}var s=o.data.x,t=o.data.y,u=p.position();n?p.move(s-u.x,t-u.y,d):(p.move(s-u.x,t-u.y,d,e),n=!0)}var v=c.edges;for(m=0;m<v.length;m++){var w=v[m],x=g[w.id];if(x===undefined){j("Warning: Can't update edge for json edge id "+w.id+" because the edge can't be found.");continue}if(!a.util.propertySetAndNotNull(w,["data","type"],["data","handles"]))continue;if(w.data.type!=="curve")continue;x.setSplineHandlePositions(w.data.handles,d),x.setSplinePoints(w.data.points,d)}}}(bui),function(a){a.layouter={},a.layouter.makeLayouterFormat=function(b){var c=0,d=1,f={},g={},h="",i={},j={};for(var k=0;k<b.nodes.length;k++){var l=b.nodes[k];if(l.is_abstract)continue;if(a.nodeMapping[l.sbo].klass===a.Compartment){g[l.id]=d,h=h+d+" "+l.id+"\n";if(l.data.subnodes)for(var m in l.data.subnodes)i[l.data.subnodes[m]]=d,j[l.data.subnodes[m]]=l.id;d++}else f[l.id]=c,c++}h=d-1+"\n"+h+"///\n",h=h+c+"\n";for(var k=0;k<b.nodes.length;k++){var l=b.nodes[k];if(!f.hasOwnProperty(l.id))continue;h=h+f[l.id]+"\n",h=h+(a.nodeMapping[l.sbo].klass===a.Process?"Reaction":"Compound")+"\n",h=h+l.id+"\n",h=h+(l.data.compartment?g[l.data.compartment]:i[l.id]?i[l.id]:0)+"\n",!l.data.compartment&&i[l.id]&&(l.data.compartment=j[l.id]),h=h+(l.data.x?l.data.x:0)+"\n",h=h+(l.data.y?l.data.y:0)+"\n",h=h+(l.data.width?l.data.width:0)+"\n",h=h+(l.data.height?l.data.height:0)+"\n",h=h+(l.data.dir?l.data.dir:0)+"\n"}h+="///\n";var n="";c=0;for(var k=0;k<b.edges.length;k++){e=b.edges[k];var o=a.edgeMarkerMapping[e.sbo],p;if(o)switch(o.klass){case a.connectingArcs.substrate.id:p="Substrate";break;case a.connectingArcs.production.id:p="Product";break;case a.connectingArcs.catalysis.id:p="Catalyst";break;case a.connectingArcs.inhibition.id:p="Inhibitor";break;case a.connectingArcs.stimulation.id:p="Activator";break;case a.connectingArcs.necessaryStimulation.id:p="Activator";break;case a.connectingArcs.control.id:p="Activator"}p&&(n=n+p+" "+f[e.source]+" "+f[e.target]+"\n",c++)}return h=h+c+"\n"+n+"\n",h},a.layouter.fromLayouterFormat=function(b,c,d){var e={},f={},g=0;for(var h=0;h<b.nodes.length;h++){var i=b.nodes[h];e[i.id]=h;if(i.is_abstract)continue;if(a.nodeMapping[i.sbo].klass===a.Compartment)continue;f[i.id]=g,g++}for(var h=0;h<b.nodes.length;h++){var i=b.nodes[h];if(i.is_abstract)continue;if(a.nodeMapping[i.sbo].klass===a.Compartment&&i.data.subnodes)for(var j in i.data.subnodes)b.nodes[e[i.data.subnodes[j]]].data.compartment=i.id}var k={};for(var h=0;h<b.edges.length;h++){var l=b.edges[h];k[f[l.source]+"->"+f[l.target]]=h}var m=c.split("\n"),n=1e18,o=1e18;while(m.length){if(m.shift()=="///")break;var p=m.shift(),q=m.shift();m.shift();var r=m.shift(),s=m.shift(),t=m.shift();if(m.length==0)break;var u=m.shift();m.shift();if(!e.hasOwnProperty(q)){q!="unknown"&&console.log("unknown id "+q+". runaway data?");continue}var i=b.nodes[e[q]];p=="Compartment"?(i.data.x=1*r,i.data.y=-s-u,i.data.width=1*t,i.data.height=1*u):(i.data.x=1*r-t/2,i.data.y=-s-u/2),n>i.data.x&&(n=i.data.x),o>i.data.y&&(o=i.data.y)}for(var h=0;h<b.nodes.length;h++){var i=b.nodes[h];if(i.is_abstract)continue;i.data.x!=undefined&&(i.data.x-=n),i.data.y!=undefined&&(i.data.y-=o)}for(var h=0;h<b.nodes.length;h++){var i=b.nodes[h];if(i.is_abstract)continue;if(e.hasOwnProperty(i.data.compartment)){var v=b.nodes[e[i.data.compartment]];i.data.x!=undefined&&(i.data.x-=v.data.x),i.data.y!=undefined&&(i.data.y-=v.data.y)}}if(d)return b;while(m.length){var w=m.shift(),x=w.split(" ");if(x.length<=3)continue;var y=x[1]+"->"+x[2];if(!k.hasOwnProperty(y))throw"Edge "+y+" not found";var z=k[y],A=x[3].split(",");A.length<2&&(A=[]);var B=1;for(var h=0;h<A.length;h++)A[h]*=B?1:-1,B=1-B;var C=x.length>=5?x[4].split(","):[];C.length<2&&(C=[]),B=1;for(var h=0;h<C.length;h++)C[h]*=B?1:-1,C[h]-=B?n:o,B=1-B;b.edges[z].data||(b.edges[z].data={}),A.length&&(b.edges[z].data.handles=A),C.length&&(b.edges[z].data.points=C)}return b}}(bui),function(a){a.grid={nodes:[],edges:[],width:0,height:0,matrix_nodes:[],grid_space:80},a.grid.spiral=function(a){var b=0,c=1,d=0,e=0,f=1,g=["x",1,1,-1,1],h=["x",1,-1,1,1],i=[],j=0;for(;;){d%c==0&&(tmp=f,f=e,e=tmp,b>3&&(b=0),++b),d+1>2*c&&(d=0,++c),++d,i.push([e*g[b],f*h[b]]),++j;if(j>=a)break}return i},a.grid.add_padding=function(){var b=a.grid.nodes,c=a.grid.matrix_nodes,d,e=a.grid.nbucketx,f=a.grid.nbuckety,g=a.grid.ebucketx,h=a.grid.ebuckety;for(d=0;d<a.grid.height;++d)if(c[0][d]!=undefined){c.push([]);for(d=0;d<a.grid.height;++d)c[a.grid.width].push(undefined);++a.grid.width,e.push({}),g.push({});for(d=0;d<b.length;++d)c[b[d].x][b[d].y]=undefined,++b[d].x,c[b[d].x][b[d].y]=1;break}for(d=0;d<a.grid.width;++d)if(c[d][0]!=undefined){for(d=0;d<a.grid.width;++d)c[d].push(undefined);++a.grid.height,f.push({}),h.push({});for(d=0;d<b.length;++d)c[b[d].x][b[d].y]=undefined,++b[d].y,c[b[d].x][b[d].y]=1;break}for(d=0;d<a.grid.height;++d)if(c[a.grid.width-1][d]!=undefined){c.push([]);for(d=0;d<a.grid.height;++d)c[a.grid.width].push(undefined);++a.grid.width,e.push({}),g.push({})}for(d=0;d<a.grid.width;++d)if(c[d][a.grid.height-1]!=undefined){for(d=0;d<a.grid.width;++d)c[d].push(undefined);++a.grid.height,f.push({}),h.push({})}a.grid.render_current()},a.grid.find_circles=function(){},a.grid.init=function(b,c,d,e,f){var g=a.grid.grid_space,h={};for(var i=0;i<b.length;++i)h[b[i].id()]=i;for(var i=0;i<c.length;++i)c[i].source_idx=h[c[i].lsource.id()],c[i].target_idx=h[c[i].ltarget.id()];a.grid.nodes=b,a.grid.edges=c,a.grid.spiral_steps=a.grid.spiral(1e4);var j=a.grid.spiral_steps;if(d==undefined||e==undefined)d=2*Math.sqrt(b.length),e=3*Math.sqrt(b.length);a.grid.max_x=Math.round(d);var k=a.grid.max_x;a.grid.max_y=Math.round(e);var l=a.grid.max_y,m,i,n=[],o=[],p={},q={},r={};for(var i=0;i<b.length;++i){var s=b[i].parent();if("identifier"in s&&s.identifier()=="Compartment"){if(!(s.id()in p)){p[s.id()]=n.length,q[n.length]=0;var t=s.topLeft();t.x<0&&s.position(1,t.y),t=s.topLeft(),t.y<0&&s.position(t.x,1),t=s.topLeft();var u=s.bottomRight();n.push({left:Math.ceil(t.x/g),top:Math.ceil(t.y/g),bottom:Math.floor(u.y/g),right:Math.floor(u.x/g)});var v=n.length-1;r[v]=(n[v].right-n[v].left+1)*(n[v].bottom-n[v].top+1),u.x>k*g&&(k=Math.round(u.x/g)),u.y>l*g&&(l=Math.round(u.y/g))}var v=p[s.id()];o[i]=n[v],q[v]+=1;if(q[v]>r[v]){alert("Compartment "+s.label()+" is to small! Current maximum number of nodes is "+r[v]+". Please resize it to make room for more nodes.");return}}}a.grid.node_idx2comp_empty_fields={};for(var i=0;i<b.length;++i)b[i].parent().id()in p&&(v=p[b[i].parent().id()],a.grid.node_idx2comp_empty_fields[i]=r[v]-q[v]);a.grid.node_idx2cborder=o;for(i=0;i<b.length;++i)m=b[i].absolutePositionCenter(),m.x>k*g&&(k=Math.round(m.x/g)),m.y>l*g&&(l=Math.round(m.y/g));a.grid.width=k+1,a.grid.height=l+1;var w=[];for(var x=0;x<=k;++x){w.push([]);for(var y=0;y<=l;++y)w[x].push(undefined)}a.grid.matrix_nodes=w,f!=undefined&&(a.grid.put_on_grid(),a.grid.render_current()),a.grid.centerx=Math.round(a.grid.width/2),a.grid.centery=Math.round(a.grid.height/2);var z={},A={},B={},C={},D={};for(var i=0;i<b.length;++i)B[i]=[],C[i]=[],D[i]=[],z[i]=[],A[i]={};for(var E=0;E<c.length;++E){var F=c[E].source_idx,G=c[E].target_idx;D[F].push(c[E].ltarget),C[G].push(c[E].lsource),B[G].push(F),z[F].push(G),z[G].push(F),A[F][E]=1,A[G][E]=1}a.grid.node_idx2nodes_idx=z,a.grid.node_idx2edges_idx=A,a.grid.node_idx2nodes_in_idx=B,a.grid.node_idx2nodes_in=C,a.grid.node_idx2nodes_out=D,a.grid.set_nodes_as_edges()},a.grid.put_on_grid=function(b){function i(b){pos=e[b].absolutePositionCenter(),cx=Math.round(pos.x/f),cy=Math.round(pos.y/f);var i=0;for(;;){if(b in c){if(!(cx>=c[b].left&&cx<=c[b].right&&cy>=c[b].top&&cy<=c[b].bottom&&a.grid.matrix_nodes[cx][cy]==undefined)){spiral_step=d[i],cx+=spiral_step[0],cy+=spiral_step[1],++i;continue}}else if(!(cx>=0&&cx<=g&&cy>=0&&cy<=h&&a.grid.matrix_nodes[cx][cy]==undefined)){spiral_step=d[i],cx+=spiral_step[0],cy+=spiral_step[1],++i;continue}a.grid.matrix_nodes[cx][cy]=b,e[b].x=cx,e[b].y=cy;break}}var c=a.grid.node_idx2cborder,d=a.grid.spiral_steps,e=a.grid.nodes,f=a.grid.grid_space,g=a.grid.max_x,h=a.grid.max_y;if(b==undefined)for(var j=0;j<e.length;++j)i(j);else i(b)},a.grid.layout=function(b){a.grid.init_ebuckets(),a.grid.init_nbuckets();var c=a.grid.nodes,d=a.grid.edges,e=a.grid.grid_space,f=a.grid.matrix_nodes,g=a.grid.node_idx2cborder,h=a.grid.node_idx2comp_empty_fields,i,j=a.grid.spiral_steps,k=a.grid.width*a.grid.height-c.length,l=a.grid.node_idx2nodes_idx,m=a.grid.node_idx2edges_idx,n=a.grid.node_idx2nodes_in_idx,o=a.grid.node_idx2nodes_in,p=a.grid.node_idx2nodes_out,q=0,r=0,s,t,u=0;console.log("line crossings before: "+a.grid.num_intersections()),console.log("node crossings before: "+a.grid.num_node_intersections()),nodes_idx_list=[];for(i=0;i<c.length;++i)nodes_idx_list.push(i);nodes_idx_list.sort(function(){return.5-Math.random()});var q;for(var v=0;v<c.length;++v){q=nodes_idx_list[v];var w=c[q];++u;if(u>c.length)break;if(l[q]==undefined){for(var x=0;x<a.grid.width;++x)for(var y=0;y<a.grid.height;++y)f[x][y]==undefined&&(f[x][y]=1,f[w.x][w.y]=undefined,w.x=x,w.y=y);continue}t=a.grid.edge_intersections_fromto(w,l[q],m[q]),t+=a.grid.node_intersections_fromto(q,w,l[q]),t+=.1*a.grid.edge_distance(w,l[q]),t+=.05*a.grid.edge_distance(w,n[q]),t+=5*a.grid.flow_fromto(w,o[q],p[q]),t+=.5*a.grid.deg90_fromto(w,l[q]),t+=.1*a.grid.graviation_from(w),r+=t;var x=w.x,y=w.y,z=0,A=undefined,B=undefined,C=undefined,D=0;for(;;){z>9990&&console.log("counter too high: "+z),x+=j[z][0],y+=j[z][1],++z;if(i in g){if(h[q]==D)break;if(!(x>=g[q].left&&x<=g[q].right&&y>=g[q].top&&y<=g[q].bottom&&f[x][y]==undefined))continue}else{if(k<=D)break;if(!(x>=0&&x<a.grid.width&&y>=0&&y<a.grid.height&&f[x][y]==undefined))continue}++D,s=a.grid.edge_intersections_fromto({x:x,y:y},l[q],m[q]),s+=a.grid.node_intersections_fromto(q,{x:x,y:y},l[q]),s+=.1*a.grid.edge_distance({x:x,y:y},l[q]),s+=.05*a.grid.edge_distance({x:x,y:y},n[q]),s+=5*a.grid.flow_fromto({x:x,y:y},o[q],p[q]),s+=.5*a.grid.deg90_fromto({x:x,y:y},l[q]),s+=.1*a.grid.graviation_from({x:x,y:y}),s<t&&(t=s,A=x,B=y,C=Math.abs(w.x-x)+Math.abs(w.y-y));if(C!=undefined&&(Math.abs(w.x-x)+Math.abs(w.y-y))*2>C)break;if(s==0)break}if(A!=undefined){a.grid.set_nbuckets(q,w.x,w.y,A,B),f[A][B]=q,f[w.x][w.y]=undefined,w.x=A,w.y=B,a.grid.set_nodes_as_edges(q);for(var i=0;i<m[q].length;++i)a.grid.set_ebuckets(m[q][i],"clear")}++q,q>=c.length-1&&(q=0)}return a.grid.render_current(),console.log("line crossings after: "+a.grid.num_intersections()),console.log("node crossings after: "+a.grid.num_node_intersections()),console.log("current_energy: "+r),r},a.grid.render_current=function(){var b=a.grid.nodes,c=a.grid.grid_space,d=0,e=0;for(i=0;i<b.length;++i)b[i].x==0&&(d=c),b[i].y==0&&(e=c);for(i=0;i<b.length;++i)b[i].absolutePositionCenter(b[i].x*c+d,b[i].y*c+e)},a.grid.edge_distance=function(b,c){distance=0;var d=a.grid.nodes;for(var e=0;e<c.length;++e)distance+=Math.abs(b.x-d[c[e]].x)+Math.abs(b.y-d[c[e]].y);return distance},a.grid.edge_intersections_fromto=function(b,c,d){var e=0,f=a.grid.edges,g=a.grid.nodes;for(var h=0;h<c.length;++h)for(var i in a.grid.edge_intersections_getedges(b,g[c[h]]))i in d||a.grid.intersect(b,g[c[h]],f[i].lsource,f[i].ltarget)&&++e;for(var h=0;h<c.length;++h)for(var i=h+1;i<c.length;++i)a.grid.intersect(b,g[c[h]],b,g[c[i]])&&++e;return e},a.grid.edge_intersections_getedges=function(b,c){var d,e,f,g,h={},i={};b.x<c.x?(d=b.x,e=c.x):(e=b.x,d=c.x);for(f=d;f<=e;++f)for(g in a.grid.ebucketx[f])h[g]=1;b.y<c.y?(d=b.y,e=c.y):(e=b.y,d=c.y);for(f=d;f<=e;++f)for(g in a.grid.ebuckety[f])g in h&&(i[g]=1);return i},a.grid.init_ebuckets=function(){var b=a.grid.edges,c=[],d=[];for(var e=0;e<a.grid.width;++e)c.push({});for(var f=0;f<a.grid.height;++f)d.push({});console.log("ebucketx length"+c.length),a.grid.ebucketx=c,a.grid.ebuckety=d;for(var g=0;g<b.length;++g)a.grid.set_ebuckets(g)},a.grid.set_ebuckets=function(b,c){var d,e,f,g=a.grid.ebucketx,h=a.grid.ebuckety,i=a.grid.edges[b];if(c!=undefined){for(d=0;d<g.length;++d)b in g[d]&&delete g[d][b];for(d=0;d<h.length;++d)b in h[d]&&delete h[d][b]}i.lsource.x<i.ltarget.x?(e=i.lsource.x,f=i.ltarget.x):(f=i.lsource.x,e=i.ltarget.x);for(d=e;d<=f;++d)g[d][b]=1;i.lsource.y<i.ltarget.y?(e=i.lsource.y,f=i.ltarget.y):(f=i.lsource.y,e=i.ltarget.y);for(d=e;d<=f;++d)h[d][b]=1},a.grid.node_intersections_fromto=function(b,c,d){var e=0,f=a.grid.nodes,g,h;for(var i=0;i<d.length;++i){g=a.grid.node_intersections_getnodes(c,d[i]);for(var j=0;j<g.length;++j){h=g[j];if(h!=b&&h!=d[i]){var k=a.grid.nodes_as_edges[h];a.grid.intersect(c,f[d[i]],k[0].source,k[0].target)?++e:a.grid.intersect(c,f[d[i]],k[1].source,k[1].target)&&++e}}}return e},a.grid.node_intersections_getnodes=function(b,c){var d=a.grid.matrix_nodes,e,f,g,h;b.x<c.x?(e=b.x,g=c.x):(e=c.x,g=b.x),b.y<c.y?(f=b.y,h=c.y):(f=c.y,h=b.y);var i,j={};for(i=e;i<=g;++i)for(key in a.grid.nbucketx[i])j[key]=1;out_nodes=[];for(i=f;i<=h;++i)for(key in a.grid.nbuckety[i])key in j&&out_nodes.push(key);return out_nodes},a.grid.init_nbuckets=function(){var b=a.grid.nodes,c=[],d=[],e;for(e=0;e<a.grid.width;++e)c.push({});for(e=0;e<a.grid.height;++e)d.push({});for(e=0;e<b.length;++e)c[b[e].x][e]=1,d[b[e].y][e]=1;a.grid.nbucketx=c,a.grid.nbuckety=d},a.grid.set_nbuckets=function(b,c,d,e,f){delete a.grid.nbucketx[c][b],delete a.grid.nbuckety[d][b],a.grid.nbucketx[e][b]=1,a.grid.nbuckety[f][b]=1},a.grid.set_nodes_as_edges=function(b){var c=a.grid.nodes,d=[],e=a.grid.grid_space;if(b==undefined){for(var f=0;f<c.length;++f){var g=c[f],h=g.size(),i=h.width/e/2,j=h.height/e/2,k={x:g.x-i,y:g.y+j},l={x:g.x+i,y:g.y-j},m={x:g.x-i,y:g.y-j},n={x:g.x+i,y:g.y+j};d.push([{source:k,target:l},{source:m,target:n}])}a.grid.nodes_as_edges=d}else{var g=c[b],h=g.size(),i=h.width/e/2,j=h.height/e/2,k={x:g.x-i,y:g.y+j},l={x:g.x+i,y:g.y-j},m={x:g.x-i,y:g.y-j},n={x:g.x+i,y:g.y+j};a.grid.nodes_as_edges[b]=[{source:k,target:l},{source:m,target:n}]}},a.grid.deg90_fromto=function(b,c){var d=0,e=a.grid.nodes;for(var f=0;f<c.length;++f)e[c[f]].x==b.x?d+=0:e[c[f]].y==b.y?d+=.1:d+=1;return d},a.grid.flow_fromto=function(b,c,d,e){if(c.length==0||d.length==0)return 0;e==undefined&&(e=a.grid.common_edge(b,c,d));if(e.x==b.x&&e.y==b.y)return 0;var f=0;common_edge_norm=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));for(var g=0;g<d.length;++g)tmp_x=d[g].x-b.x,tmp_y=d[g].y-b.y,f+=(1-(tmp_x*e.x+tmp_y*e.y)/(Math.sqrt(Math.pow(tmp_x,2)+Math.pow(tmp_y,2))*common_edge_norm))/2;for(var g=0;g<c.length;++g)tmp_x=b.x-c[g].x,tmp_y=b.y-c[g].y,f+=(1-(tmp_x*e.x+tmp_y*e.y)/(Math.sqrt(Math.pow(tmp_x,2)+Math.pow(tmp_y,2))*common_edge_norm))/2;return isNaN(f)?0:f},a.grid.common_edge=function(a,b,c){var d=0,e=0,f;for(var g=0;g<b.length;++g)tmp_x=a.x-b[g].x,tmp_y=a.y-b[g].y,f=Math.sqrt(Math.pow(tmp_x,2)+Math.pow(tmp_y,2)),d+=tmp_x/f,e+=tmp_y/f;for(var g=0;g<c.length;++g)tmp_x=c[g].x-a.x,tmp_y=c[g].y-a.y,f=Math.sqrt(Math.pow(tmp_x,2)+Math.pow(tmp_y,2)),d+=tmp_x/f,e+=tmp_y/f;return{x:d,y:e}},a.grid.angle=function(b,c){var d={x:b.x,y:b.y-Math.sqrt(Math.abs(c.x-b.x)*Math.abs(c.x-b.x)+Math.abs(c.y-b.y)*Math.abs(c.y-b.y))};return 2*Math.atan2(c.y-d.y,c.x-d.x)*180/Math.PI},a.grid.graviation_from=function(b){var c=Math.abs(b.x-a.grid.centerx)+Math.abs(b.y-a.grid.centery);return c/(a.grid.width+a.grid.height)*2},a.grid.node_swap=function(a,b,c,d){},a.grid.ccw=function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)},a.grid.collinear=function(a,b,c){return(a.y-b.y)*(a.x-c.x)==(a.y-c.y)*(a.x-b.x)},a.grid.point_on_segment=function(a,b,c){return a.x==b.x?a.y<b.y?a.y<c.y&&b.y>c.y?!0:!1:b.y<c.y&&a.y>c.y?!0:!1:a.x<b.x?a.x<c.x&&b.x>c.x?!0:!1:b.x<c.x&&a.x>c.x?!0:!1},a.grid.intersect=function(b,c,d,e,f){return a.grid.collinear(b,c,d)?a.grid.collinear(b,c,e)?b.x==c.x?b.y>=d.y&&c.y>=d.y&&b.y>=e.y&&c.y>=e.y||b.y<=d.y&&c.y<=d.y&&b.y<=e.y&&c.y<=e.y?!1:!0:b.x>=d.x&&c.x>=d.x&&b.x>=e.x&&c.x>=e.x||b.x<=d.x&&c.x<=d.x&&b.x<=e.x&&c.x<=e.x?!1:!0:a.grid.point_on_segment(b,c,d):a.grid.collinear(b,c,e)?a.grid.point_on_segment(b,c,e):a.grid.collinear(d,e,b)?a.grid.point_on_segment(d,e,b):a.grid.collinear(d,e,c)?a.grid.point_on_segment(d,e,c):a.grid.ccw(b,d,e)!=a.grid.ccw(c,d,e)&&a.grid.ccw(b,c,d)!=a.grid.ccw(b,c,e)},a.grid.num_intersections=function(b,c){var d=0,e=[];for(var f=0;f<a.grid.edges.length;++f)for(var g=f+1;g<a.grid.edges.length;++g)a.grid.intersect(a.grid.edges[f].lsource,a.grid.edges[f].ltarget,a.grid.edges[g].lsource,a.grid.edges[g].ltarget,c)==1&&(b!=undefined&&(f in b?(e.push(g),c!=undefined&&(a.grid.edges[g].addPoint(1,1,"Outcome"),a.grid.edges[g].recalculatePoints())):g in b&&(e.push(f),c!=undefined&&(a.grid.edges[f].addPoint(1,1,"Outcome"),a.grid.edges[f].recalculatePoints()))),++d);return b!=undefined?e:d},a.grid.num_node_intersections=function(b,c){var d=0,e=a.grid.edges;for(var f=0;f<e.length;++f)for(var g=0;g<a.grid.nodes.length;++g)if(g!=e[f].source_idx&&g!=e[f].target_idx){var h=a.grid.nodes_as_edges[g];a.grid.intersect(e[f].lsource,e[f].ltarget,h[0].source,h[0].target)?++d:a.grid.intersect(e[f].lsource,e[f].ltarget,h[1].source,h[1].target)&&++d}return d},a.grid.bfs_layout=function(){function q(b){b.bfs_grid=!0;var c=!1,d=[];g=b.idx;for(m=0;m<node_idx2parents[g].length;++m)node_parent=node_idx2parents[g][m],node_parent.bfs_grid!=undefined&&(c=!0,d.push(node_idx2parents[g][m]));c==0?(n=Math.abs(a.grid.centerx/a.grid.grid_space/2),o=Math.abs(a.grid.centery/a.grid.grid_space/2),a.grid.put_on_grid(g,n,o)):console.log("should layout one node now");for(m=0;m<node_idx2children[g].length;++m)node_idx2children[g][m].bfs_grid==undefined&&q(node_idx2children[g][m])}var b=a.grid.nodes,c=a.grid.edges,d=a.grid.matrix_nodes,e={},f={};for(var g=0;g<b.length;++g)b[g].idx=g,node_idx2children[g]=[],node_idx2parents[g]=[];for(var h=0;h<c.length;++h){var i=c[h].source().idx,j=c[h].source(),k=c[h].target().idx,l=c[h].target();node_idx2children[i].push(l),node_idx2parents[k].push(j)}for(var m=0;m<b.length;++m)b[m].bfs_grid==undefined&&q(b[m]);var m,n,o,g,p},a.grid.bfs_tarjan=function(){function m(a){j.push(a),k[a.id()]=1,a.dfsnum=i,a.low=i,++i;for(var b=0;b<d[a.id()].length;++b)q=d[a.id()][b],q.dfsnum==undefined?(m(q),q.low=Math.min(a.low,q.low)):q in k&&(a.low=Math.min(a.low,q.dfsnum));if(a.low==a.dfsnum&&j.length>0){console.log("strong connected:");do{var c=j.pop();delete k[c.id()],console.log("node - "+c.label())}while(c.id()==a.id())}}var b=a.grid.nodes,c=a.grid.edges,d={};for(var e=0;e<b.length;++e)d[b[e].id()]=[];for(var f=0;f<c.length;++f){var g=c[f].source().id(),h=c[f].target();d[g].push(h)}var i=0,j=[],k={};for(var l=0;l<b.length;++l)b[l].dfsnum==undefined&&m(b[l])}}(bui),a.bui=bui})(window)